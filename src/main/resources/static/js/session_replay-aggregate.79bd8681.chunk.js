"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[590],{6945:(e,t,s)=>{let i;s.d(t,{m:()=>o});const r=new Promise((e=>{i=e})),o=Object.freeze({onReplayReady:i,sessionReplayInitialized:r})},7661:(e,t,s)=>{s.d(t,{o:()=>h});var i=s(3197),r=s(3114),o=s(2041),n=s(8464),a=s(2162);class h extends r.w{constructor(e,t,s){var i;super(s),this.endpoint=e,this.opts=t||{},this.started=!1,this.timeoutHandle=null,this.aborted=!1,this.harvest=new o.M(this.sharedContext),(0,n.L)(this.unload.bind(this)),null===(i=this.sharedContext)||void 0===i||i.ee.on(a.wO.RESET,(()=>this.runHarvest({forceNoRetry:!0})))}unload(){this.aborted||(this.opts.onUnload&&this.opts.onUnload(),this.runHarvest({unload:!0}))}startTimer(e,t){this.interval=e,this.started=!0,this.scheduleHarvest(null!=t?t:this.interval)}stopTimer(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.aborted=e,this.started=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)}scheduleHarvest(e,t){this.timeoutHandle||(null==e&&(e=this.interval),this.timeoutHandle=setTimeout((()=>{this.timeoutHandle=null,this.runHarvest(t)}),1e3*e))}runHarvest(e){if(this.aborted)return;const t=t=>{null!==e&&void 0!==e&&e.forceNoRetry&&(t.retry=!1),this.onHarvestFinished(e,t)};let s,r,o=[];if(this.opts.getPayload){if(s=i.qD({isFinalHarvest:null===e||void 0===e?void 0:e.unload}),!s)return!1;const t=!(null!==e&&void 0!==e&&e.unload)&&s===i.Be;if(r=this.opts.getPayload({retry:t}),!r)return void(this.started&&this.scheduleHarvest());r="[object Array]"===Object.prototype.toString.call(r)?r:[r],o.push(...r)}let n=e=>this.harvest.sendX(e);o.length?n=this.opts.raw?e=>this.harvest._send(e):e=>this.harvest.send(e):o.push(void 0),o.forEach((i=>{n({endpoint:this.endpoint,payload:i,opts:e,submitMethod:s,cbFinished:t,customUrl:this.opts.customUrl,raw:this.opts.raw})})),this.started&&this.scheduleHarvest()}onHarvestFinished(e,t){if(this.opts.onFinished&&this.opts.onFinished(t),t.sent&&t.retry){const s=t.delay||this.opts.retryDelay;this.started&&s?(clearTimeout(this.timeoutHandle),this.timeoutHandle=null,this.scheduleHarvest(s,e)):!this.started&&s&&this.scheduleHarvest(s,e)}}}},8464:(e,t,s)=>{s.d(t,{L:()=>n});var i=s(1997),r=s(3980),o=s(536);if(r.v6){r._A.cleanupTasks=[];const e=r._A.close;r._A.close=()=>{for(let e of r._A.cleanupTasks)e();e()}}function n(e){r.il?((0,o.N)(e,!0),(0,i.bP)("pagehide",e)):r.v6&&r._A.cleanupTasks.push(e)}},3685:(e,t,s)=>{s.r(t),s.d(t,{Aggregate:()=>M});var i=s(4572),r=s(4613),o=s(7661),n=s(1477),a=s(8958),h=s(1527),d=s(6945),l=s(6323),c=s(1760),u=s(3980),p=s(6477),v=s(5894),y=s(9025),m=s(8374),f=s(6276),g=s(2162),b=s(8038),R=s(4939);let S,T;class M extends h.m{constructor(e,t,s){super(e,t,n.t9),this.harvestTimeSeconds=(0,a.Mt)(this.agentIdentifier,"session_replay.harvestTimeSeconds")||60,this.initialized=!1,this.blocked=!1,this.shouldCompress=!0;const{session:i}=(0,a.OP)(this.agentIdentifier);this.mode=i.state.sessionReplayMode||g.IK.OFF,this.entitled=!1,this.recorder=null===s||void 0===s?void 0:s.recorder,this.recorder&&(this.recorder.parent=this);!0===(0,a.Mt)(e,"privacy.cookies_enabled")&&!0===(0,a.Mt)(e,"session_trace.enabled")&&(this.ee.on(g.wO.RESET,(()=>{this.scheduler.runHarvest(),this.abort(n.Mi.RESET)})),this.ee.on(g.wO.PAUSE,(()=>{var e;null===(e=this.recorder)||void 0===e||e.stopRecording()})),this.ee.on(g.wO.RESUME,(()=>{var e;if(!this.recorder)return;const{session:t}=(0,a.OP)(this.agentIdentifier);this.mode=t.state.sessionReplayMode,this.initialized&&this.mode!==g.IK.OFF&&(null===(e=this.recorder)||void 0===e||e.startRecording())})),this.ee.on(g.wO.UPDATE,((e,t)=>{this.recorder&&this.initialized&&!this.blocked&&e===g.uT.CROSS_TAB&&(this.mode!==g.IK.OFF&&t.sessionReplayMode===g.IK.OFF&&this.abort(n.Mi.CROSS_TAB),this.mode=t.sessionReplay)})),this.scheduler=new o.o("browser/blobs",{onFinished:this.onHarvestFinished.bind(this),retryDelay:this.harvestTimeSeconds,getPayload:this.prepareHarvest.bind(this),raw:!0},this),(0,r.X)("recordReplay",(()=>{!this.blocked&&this.entitled&&(this.recorder?this.mode!==g.IK.FULL&&this.switchToFull():this.initializeRecording(!1,!0,!0))}),this.featureName,this.ee),(0,r.X)("pauseReplay",(()=>{this.forceStop(this.mode!==g.IK.ERROR)}),this.featureName,this.ee),(0,r.X)("errorAgg",(e=>{this.errorNoticed=!0,this.recorder&&(this.recorder.currentBufferTarget.hasError=!0),this.mode===g.IK.ERROR&&"visible"===(null===u._A||void 0===u._A?void 0:u._A.document.visibilityState)&&this.switchToFull()}),this.featureName,this.ee),this.waitForFlags(["sr"]).then((e=>{var t;let[s]=e;this.entitled=s,!this.entitled&&null!==(t=this.recorder)&&void 0!==t&&t.recording&&this.recorder.abort(n.Mi.ENTITLEMENTS),this.initializeRecording(100*Math.random()<(0,a.Mt)(this.agentIdentifier,"session_replay.error_sampling_rate"),100*Math.random()<(0,a.Mt)(this.agentIdentifier,"session_replay.sampling_rate"))})).then((()=>d.m.onReplayReady(this.mode))),this.drain())}switchToFull(){this.mode=g.IK.FULL,this.recorder&&this.initialized&&(this.recorder.stopRecording(),this.recorder.startRecording(),this.scheduler.startTimer(this.harvestTimeSeconds),this.syncWithSessionManager({sessionReplayMode:this.mode}))}async initializeRecording(e,t,i){if(this.initialized=!0,!this.entitled)return;const{session:r}=(0,a.OP)(this.agentIdentifier);if(r.isNew||i)if(t)this.mode=g.IK.FULL;else{if(!e)return;this.mode=g.IK.ERROR}else this.mode=r.state.sessionReplayMode;if(!this.recorder)try{const{Recorder:e}=await s.e(538).then(s.bind(s,8198));this.recorder=new e(this),this.recorder.currentBufferTarget.hasError=this.errorNoticed}catch(o){return this.abort(n.Mi.IMPORT)}this.mode===g.IK.ERROR&&this.errorNoticed&&(this.mode=g.IK.FULL),this.mode!==g.IK.FULL||this.scheduler.started||this.scheduler.startTimer(this.harvestTimeSeconds);try{const{gzipSync:e,strToU8:t}=await s.e(675).then(s.bind(s,1617));S=e,T=t}catch(o){this.shouldCompress=!1}this.recorder.recording||this.recorder.startRecording(),this.syncWithSessionManager({sessionReplayMode:this.mode})}prepareHarvest(){if(!this.recorder)return;const e=this.recorder.getEvents();if(!e.events.length||this.mode!==g.IK.FULL||this.blocked)return;const t=this.getHarvestContents(e);if(!t.body.length)return void this.recorder.clearBuffer();let s=0;if(this.shouldCompress?(t.body=S(T("[".concat(t.body.map((e=>e.__serialized)).join(","),"]"))),s=t.body.length,this.scheduler.opts.gzip=!0):(t.body=t.body.map((e=>{let{__serialized:t,...s}=e;return s})),s=(0,b.P)(t.body).length,this.scheduler.opts.gzip=!1),s>n.Ye)return void this.abort(n.Mi.TOO_BIG);const{session:i}=(0,a.OP)(this.agentIdentifier);return i.state.sessionReplaySentFirstChunk||this.syncWithSessionManager({sessionReplaySentFirstChunk:!0}),this.recorder.clearBuffer(),"preloaded"===e.type&&this.scheduler.runHarvest(),[t]}getHarvestContents(e){var t,s,i,r,o,h;null!==(t=e)&&void 0!==t||(e=this.recorder.getEvents());let d=e.events;const c=(0,a.OP)(this.agentIdentifier),u=(0,a.C5)(this.agentIdentifier),p=null===(s=u.jsAttributes)||void 0===s?void 0:s["enduser.id"];(null===(i=d)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.type)===n.i9.FullSnapshot&&this.recorder.lastMeta&&(e.hasMeta=!0,d.unshift(this.recorder.lastMeta),this.recorder.lastMeta=void 0);(null===(r=d[d.length-1])||void 0===r?void 0:r.type)===n.i9.Meta&&(this.recorder.lastMeta=d[d.length-1],d=d.slice(0,d.length-1),e.hasMeta=!!d.find((e=>e.type===n.i9.Meta)));const v=(0,a.OP)(this.agentIdentifier).offset,y=(0,f.z)(),g=null===(o=d[0])||void 0===o?void 0:o.timestamp,b=null===(h=d[d.length-1])||void 0===h?void 0:h.timestamp,S=g||e.cycleTimestamp,T=b||v+y;return{qs:{browser_monitoring_key:u.licenseKey,type:"SessionReplay",app_id:u.applicationID,protocol_version:"0",attributes:(0,l.j6)({...this.shouldCompress&&{content_encoding:"gzip"},"replay.firstTimestamp":S,"replay.firstTimestampOffset":S-v,"replay.lastTimestamp":T,"replay.durationMs":T-S,"replay.nodes":d.length,"session.durationMs":c.session.getDuration(),agentVersion:c.version,session:c.session.state.value,rst:y,hasMeta:e.hasMeta||!1,hasSnapshot:e.hasSnapshot||!1,hasError:e.hasError||!1,isFirstChunk:!1===c.session.state.sessionReplaySentFirstChunk,decompressedBytes:e.payloadBytesEstimation,invalidStylesheetsDetected:R.j.invalidStylesheetsDetected,inlinedAllStylesheets:e.inlinedAllStylesheets,"rrweb.version":m.lF,...p&&{"enduser.id":p}},n.J0).substring(1)},body:d}}onHarvestFinished(e){429===e.status&&this.abort(n.Mi.TOO_MANY),this.blocked&&this.scheduler.stopTimer(!0)}forceStop(e){var t,s;e&&this.scheduler.runHarvest(),this.mode=g.IK.OFF,null===(t=this.recorder)||void 0===t||null===(s=t.stopRecording)||void 0===s||s.call(t),this.syncWithSessionManager({sessionReplayMode:this.mode})}abort(){var e,t,s,i,r,o;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,c.Z)("SR aborted -- ".concat(n.message)),(0,v.p)(p.xS,["SessionReplay/Abort/".concat(n.sm)],void 0,y.D.metrics,this.ee),this.blocked=!0,this.mode=g.IK.OFF,null===(e=this.recorder)||void 0===e||null===(t=e.stopRecording)||void 0===t||t.call(e),this.syncWithSessionManager({sessionReplayMode:this.mode}),null===(s=this.recorder)||void 0===s||null===(i=s.clearTimestamps)||void 0===i||i.call(s),this.ee.emit("REPLAY_ABORTED"),null===(r=this.recorder)||void 0===r||null===(o=r.clearBuffer)||void 0===o||o.call(r)}syncWithSessionManager(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{session:t}=(0,a.OP)(this.agentIdentifier);t.write(e)}}(0,i.Z)(M,"featureName",n.t9)},4939:(e,t,s)=>{s.d(t,{j:()=>y});var i=s(101),r=s(4572),o=s(2346),n=s(3092),a=s(3889),h=s(6033),d=s(8958),l=s(3980),c=new WeakMap,u=new WeakMap,p=new WeakSet;async function v(e,t){const s=await d.Yu.FETCH.bind(window)(t);if(!s.ok)return void(this.failedToFix=!0);const i=await s.text();try{const t=new CSSStyleSheet;await t.replace(i),Object.defineProperty(e,"cssRules",{get:()=>t.cssRules}),Object.defineProperty(e,"rules",{get:()=>t.rules})}catch(r){Object.defineProperty(e,"cssText",{get:()=>i}),this.failedToFix=!0}}const y=new class{constructor(){(0,i.Z)(this,p),(0,o.Z)(this,c,{writable:!0,value:new WeakSet}),(0,o.Z)(this,u,{writable:!0,value:[]}),(0,r.Z)(this,"invalidStylesheetsDetected",!1),(0,r.Z)(this,"failedToFix",!1)}evaluate(){let e=0;if(l.il)for(let s=0;s<Object.keys(document.styleSheets).length;s++){const i=document.styleSheets[s];if(!(0,h.Z)(this,c).has(i)){(0,h.Z)(this,c).add(i);try{i.cssRules}catch(t){e++,(0,h.Z)(this,u).push((0,a.Z)(this,p,v).call(this,document.styleSheets[s],i.href))}}}return e&&(this.invalidStylesheetsDetected=!0),e}async fix(){await Promise.all((0,h.Z)(this,u)),(0,n.Z)(this,u,[]);const e=this.failedToFix;return this.failedToFix=!1,e}}},3092:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(1519);function r(e,t,s){return function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=s}}(e,(0,i.Z)(e,t,"set"),s),s}}}]);
//# sourceMappingURL=session_replay-aggregate.79bd8681.chunk.js.map