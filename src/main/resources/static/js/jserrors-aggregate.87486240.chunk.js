"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[317],{7661:(e,t,r)=>{r.d(t,{o:()=>c});var s=r(3197),n=r(3114),i=r(2041),a=r(8464),o=r(2162);class c extends n.w{constructor(e,t,r){var s;super(r),this.endpoint=e,this.opts=t||{},this.started=!1,this.timeoutHandle=null,this.aborted=!1,this.harvest=new i.M(this.sharedContext),(0,a.L)(this.unload.bind(this)),null===(s=this.sharedContext)||void 0===s||s.ee.on(o.wO.RESET,(()=>this.runHarvest({forceNoRetry:!0})))}unload(){this.aborted||(this.opts.onUnload&&this.opts.onUnload(),this.runHarvest({unload:!0}))}startTimer(e,t){this.interval=e,this.started=!0,this.scheduleHarvest(null!=t?t:this.interval)}stopTimer(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.aborted=e,this.started=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)}scheduleHarvest(e,t){this.timeoutHandle||(null==e&&(e=this.interval),this.timeoutHandle=setTimeout((()=>{this.timeoutHandle=null,this.runHarvest(t)}),1e3*e))}runHarvest(e){if(this.aborted)return;const t=t=>{null!==e&&void 0!==e&&e.forceNoRetry&&(t.retry=!1),this.onHarvestFinished(e,t)};let r,n,i=[];if(this.opts.getPayload){if(r=s.qD({isFinalHarvest:null===e||void 0===e?void 0:e.unload}),!r)return!1;const t=!(null!==e&&void 0!==e&&e.unload)&&r===s.Be;if(n=this.opts.getPayload({retry:t}),!n)return void(this.started&&this.scheduleHarvest());n="[object Array]"===Object.prototype.toString.call(n)?n:[n],i.push(...n)}let a=e=>this.harvest.sendX(e);i.length?a=this.opts.raw?e=>this.harvest._send(e):e=>this.harvest.send(e):i.push(void 0),i.forEach((s=>{a({endpoint:this.endpoint,payload:s,opts:e,submitMethod:r,cbFinished:t,customUrl:this.opts.customUrl,raw:this.opts.raw})})),this.started&&this.scheduleHarvest()}onHarvestFinished(e,t){if(this.opts.onFinished&&this.opts.onFinished(t),t.sent&&t.retry){const r=t.delay||this.opts.retryDelay;this.started&&r?(clearTimeout(this.timeoutHandle),this.timeoutHandle=null,this.scheduleHarvest(r,e)):!this.started&&r&&this.scheduleHarvest(r,e)}}}},8464:(e,t,r)=>{r.d(t,{L:()=>a});var s=r(1997),n=r(3980),i=r(536);if(n.v6){n._A.cleanupTasks=[];const e=n._A.close;n._A.close=()=>{for(let e of n._A.cleanupTasks)e();e()}}function a(e){n.il?((0,i.N)(e,!0),(0,s.bP)("pagehide",e)):n.v6&&n._A.cleanupTasks.push(e)}},1645:(e,t,r)=>{r.r(t),r.d(t,{Aggregate:()=>j});var s=r(4572);const n=/([a-z0-9]+)$/i;function i(e){if(!e)return;const t=e.match(n);return t?t[1]:void 0}var a=/^\n+|\n+$/g;function o(e){return function(e){var t;if(e.length>100){var r=e.length-100;t=e.slice(0,50).join("\n"),t+="\n< ...truncated "+r+" lines... >\n",t+=e.slice(-50).join("\n")}else t=e.join("\n");return t}(e).replace(a,"")}var c=r(3980),h=r(8575);function u(e){if("string"!==typeof e)return"";const t=(0,h.f)(e);return t===(0,h.f)(c.FN)?"<inline>":t}var d=!1,l=/function (.+?)\s*\(/,v=/^\s*at (?:((?:\[object object\])?(?:[^(]*\([^)]*\))*[^()]*(?: \[as \S+\])?) )?\(?((?:file|http|https|chrome-extension):.*?)?:(\d+)(?::(\d+))?\)?\s*$/i,f=/^\s*(?:(\S*|global code)(?:\(.*?\))?@)?((?:file|http|https|chrome|safari-extension).*?):(\d+)(?::(\d+))?\s*$/i,m=/^\s*at .+ \(eval at \S+ \((?:(?:file|http|https):[^)]+)?\)(?:, [^:]*:\d+:\d+)?\)$/i,g=/^\s*at Function code \(Function code:\d+:\d+\)\s*/i;function p(e){var t=null;try{if(t=function(e){if(!e.stack)return null;var t=e.stack.split("\n").reduce(k,{frames:[],stackLines:[],wrapperSeen:!1});return t.frames.length?{mode:"stack",name:e.name||b(e),message:e.message,stackString:o(t.stackLines),frames:t.frames}:null}(e),t)return t}catch(r){d}try{if(t=function(e){if(!("line"in e))return null;var t=e.name||b(e);if(!e.sourceURL)return{mode:"sourceline",name:t,message:e.message,stackString:t+": "+e.message+"\n    in evaluated code",frames:[{func:"evaluated code"}]};var r=u(e.sourceURL),s=t+": "+e.message+"\n    at "+r;e.line&&(s+=":"+e.line,e.column&&(s+=":"+e.column));return{mode:"sourceline",name:t,message:e.message,stackString:s,frames:[{url:r,line:e.line,column:e.column}]}}(e),t)return t}catch(r){d}try{if(t=function(e){var t=e.name||b(e);return t?{mode:"nameonly",name:t,message:e.message,stackString:t+": "+e.message,frames:[]}:null}(e),t)return t}catch(r){d}return{mode:"failed",stackString:"",frames:[]}}function k(e,t){let r=function(e){var t=e.match(f);t||(t=e.match(v));if(t)return{url:t[2],func:"Anonymous function"!==t[1]&&"global code"!==t[1]&&t[1]||null,line:+t[3],column:t[4]?+t[4]:null};if(e.match(m)||e.match(g)||"anonymous"===e)return{func:"evaluated code"}}(t);if(!r)return e.stackLines.push(t),e;var s;if((s=r.func)&&s.indexOf("nrWrapper")>=0&&(e.wrapperSeen=!0),!e.wrapperSeen){let s=u(r.url);s!==r.url&&(t=t.replace(r.url,s),r.url=s),e.stackLines.push(t),e.frames.push(r)}return e}function b(e){var t=l.exec(String(e.constructor));return t&&t.length>1?t[1]:"unknown"}function y(e){var t=0;if(!e||!e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}var _=r(4613),H=r(7661),S=r(8038),I=r(5894),C=r(3973),w=r(8958),A=r(6276),P=r(7685),D=r(9025),N=r(1527);class j extends N.m{constructor(e,t){var r;super(e,t,P.t),r=this,this.stackReported={},this.observedAt={},this.pageviewReported={},this.errorCache={},this.currentBody=void 0,this.errorOnPage=!1,this.ee.on("interactionSaved",(e=>this.onInteractionSaved(e))),this.ee.on("interactionDiscarded",(e=>this.onInteractionDiscarded(e))),(0,_.X)("err",(function(){return r.storeError(...arguments)}),this.featureName,this.ee),(0,_.X)("ierr",(function(){return r.storeError(...arguments)}),this.featureName,this.ee);const s=(0,w.Mt)(this.agentIdentifier,"jserrors.harvestTimeSeconds")||10,n=new H.o("jserrors",{onFinished:function(){return r.onHarvestFinished(...arguments)}},this);n.harvest.on("jserrors",(function(){return r.onHarvestStarted(...arguments)})),this.ee.on("drain-".concat(this.featureName),(()=>{this.blocked||n.startTimer(s)})),(0,_.X)("block-err",(()=>{this.blocked=!0,n.stopTimer(!0)}),this.featureName,this.ee),this.drain()}onHarvestStarted(e){var t=this.aggregator.take(["err","ierr","xhr"]);e.retry&&(this.currentBody=t);var r={body:t,qs:{}},s=(0,S.P)((0,w.OP)(this.agentIdentifier).releaseIds);return"{}"!==s&&(r.qs.ri=s),t&&t.err&&t.err.length&&!this.errorOnPage&&(r.qs.pve="1",this.errorOnPage=!0),r}onHarvestFinished(e){e.retry&&this.currentBody&&((0,C.D)(this.currentBody,((e,t)=>{for(var r=0;r<t.length;r++){var s=t[r],n=this.getBucketName(e,s.params,s.custom);this.aggregator.merge(e,n,s.metrics,s.params,s.custom)}})),this.currentBody=null)}nameHash(e){return y("".concat(e.exceptionClass,"_").concat(e.message,"_").concat(e.stack_trace||e.browser_stack_hash))}getBucketName(e,t,r){return"xhr"===e?y((0,S.P)(t))+":"+y((0,S.P)(r)):this.nameHash(t)+":"+y((0,S.P)(r))}buildCanonicalStackString(e){for(var t="",r=0;r<e.frames.length;r++){var s=e.frames[r],n=i(s.func);t&&(t+="\n"),n&&(t+=n+"@"),"string"===typeof s.url&&(t+=s.url),s.line&&(t+=":"+s.line)}return t}storeError(e,t,r,s){var n,i;t=t||(0,A.z)();const a=(0,w.OP)(this.agentIdentifier);let o;if(!r&&a.onerror&&(o=a.onerror(e),o&&("string"!==typeof o.group||!o.group.length)))return;var h=p(e);const u={stackHash:y(this.buildCanonicalStackString(h)),exceptionClass:h.name,request_uri:null===c._A||void 0===c._A?void 0:c._A.location.pathname};h.message&&(u.message=""+h.message),null!==(n=o)&&void 0!==n&&n.group&&(u.errorGroup=o.group);var d,l=y("".concat(h.name,"_").concat(h.message,"_").concat(h.stackString));this.stackReported[l]?u.browser_stack_hash=y(h.stackString):(this.stackReported[l]=!0,u.stack_trace=(d=h.stackString).length>65530?d.substr(0,65530):d,this.observedAt[l]=a.offset+t),u.releaseIds=(0,S.P)(a.releaseIds),this.pageviewReported[l]||(u.pageview=1,this.pageviewReported[l]=!0),null!==a&&void 0!==a&&null!==(i=a.session)&&void 0!==i&&null!==(i=i.state)&&void 0!==i&&i.sessionReplayMode&&(u.hasReplay=!0),u.firstOccurrenceTimestamp=this.observedAt[l];var v=r?"ierr":"err",f={time:t};const m=[v,l,u,f];if((0,I.p)("errorAgg",m,void 0,D.D.sessionTrace,this.ee),(0,I.p)("errorAgg",m,void 0,D.D.spa,this.ee),(0,I.p)("errorAgg",m,void 0,D.D.sessionReplay,this.ee),!this.blocked){var g=(0,w.C5)(this.agentIdentifier).jsAttributes;if(null!=u._interactionId)this.errorCache[u._interactionId]=this.errorCache[u._interactionId]||[],this.errorCache[u._interactionId].push([v,l,u,f,g,s]);else{var k={};(0,C.D)(g,_),s&&(0,C.D)(s,_);var b=l+":"+y((0,S.P)(k));this.aggregator.store(v,b,u,f,k)}}function _(e,t){k[e]=t&&"object"===typeof t?(0,S.P)(t):t}}onInteractionSaved(e){this.errorCache[e.id]&&!this.blocked&&(this.errorCache[e.id].forEach((t=>{var r={},s=t[4],n=t[5];(0,C.D)(s,o),(0,C.D)(e.root.attrs.custom,o),(0,C.D)(n,o);var i=t[2];i.browserInteractionId=e.root.attrs.id,delete i._interactionId,i._interactionNodeId&&(i.parentNodeId=i._interactionNodeId.toString(),delete i._interactionNodeId);var a=t[1]+e.root.attrs.id+":"+y((0,S.P)(r));function o(e,t){r[e]=t&&"object"===typeof t?(0,S.P)(t):t}this.aggregator.store(t[0],a,i,t[3],r)})),delete this.errorCache[e.id])}onInteractionDiscarded(e){this.errorCache&&this.errorCache[e.id]&&!this.blocked&&(this.errorCache[e.id].forEach((t=>{var r={},s=t[4],n=t[5];(0,C.D)(s,o),(0,C.D)(e.root.attrs.custom,o),(0,C.D)(n,o);var i=t[2];delete i._interactionId,delete i._interactionNodeId;var a=t[1]+":"+y((0,S.P)(r));function o(e,t){r[e]=t&&"object"===typeof t?(0,S.P)(t):t}this.aggregator.store(t[0],a,t[2],t[3],r)})),delete this.errorCache[e.id])}}(0,s.Z)(j,"featureName",P.t)}}]);
//# sourceMappingURL=jserrors-aggregate.87486240.chunk.js.map