{"version":3,"file":"static/js/spa-aggregate.3d3d75d7.chunk.js","mappings":"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","sources":["../node_modules/@newrelic/browser-agent/dist/esm/common/deny-list/deny-list.js","../node_modules/@newrelic/browser-agent/dist/esm/common/harvest/harvest-scheduler.js","../node_modules/@newrelic/browser-agent/dist/esm/common/serialize/bel-serializer.js","../node_modules/@newrelic/browser-agent/dist/esm/common/timing/nav-timing.js","../node_modules/@newrelic/browser-agent/dist/esm/common/unload/eol.js","../node_modules/@newrelic/browser-agent/dist/esm/common/vitals/constants.js","../node_modules/@newrelic/browser-agent/dist/esm/common/vitals/first-contentful-paint.js","../node_modules/@newrelic/browser-agent/dist/esm/common/vitals/first-paint.js","../node_modules/@newrelic/browser-agent/dist/esm/common/vitals/vital-metric.js","../node_modules/@newrelic/browser-agent/dist/esm/features/spa/aggregate/interaction-node.js","../node_modules/@newrelic/browser-agent/dist/esm/features/spa/aggregate/interaction.js","../node_modules/@newrelic/browser-agent/dist/esm/features/spa/aggregate/serializer.js","../node_modules/@newrelic/browser-agent/dist/esm/features/spa/aggregate/index.js","../node_modules/@newrelic/browser-agent/node_modules/web-vitals/dist/web-vitals.js"],"sourcesContent":["/** An array of filter objects {hostname, pathname} for identifying XHR events to be excluded from collection.\n * @see {@link https://docs.newrelic.com/docs/browser/new-relic-browser/configuration/filter-ajax-request-events/ Filter AjaxRequest events}\n * @type {Array.<{hostname: string, pathname: string}>}\n */\nvar denyList = [];\n\n/**\n * Evaluates whether an XHR event should be included for collection based on the {@link denyList|AjaxRequest deny list}.\n * @param {Object} params - object with properties of the XHR event\n * @returns {boolean} `true` if request does not match any entries of {@link denyList|deny list}; else `false`\n */\nexport function shouldCollectEvent(params) {\n  if (denyList.length === 0) {\n    return true;\n  }\n\n  // XHR requests with an undefined hostname (e.g., data URLs) should not be collected.\n  if (params.hostname === undefined) {\n    return false;\n  }\n  for (var i = 0; i < denyList.length; i++) {\n    var parsed = denyList[i];\n    if (parsed.hostname === '*') {\n      return false;\n    }\n    if (domainMatchesPattern(parsed.hostname, params.hostname) && comparePath(parsed.pathname, params.pathname)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Initializes the {@link denyList|XHR deny list} by extracting hostname and pathname from an array of filter strings.\n * @param {string[]} denyListConfig - array of URL filters to identify XHR requests to be excluded from collection\n */\nexport function setDenyList(denyListConfig) {\n  denyList = [];\n  if (!denyListConfig || !denyListConfig.length) {\n    return;\n  }\n  for (var i = 0; i < denyListConfig.length; i++) {\n    let url = denyListConfig[i];\n    if (!url) continue; // ignore bad values like undefined or empty strings\n\n    if (url.indexOf('http://') === 0) {\n      url = url.substring(7);\n    } else if (url.indexOf('https://') === 0) {\n      url = url.substring(8);\n    }\n    const firstSlash = url.indexOf('/');\n    let host, pathname;\n    if (firstSlash > 0) {\n      host = url.substring(0, firstSlash);\n      pathname = url.substring(firstSlash);\n    } else {\n      host = url;\n      pathname = '';\n    }\n    let [hostname] = host.split(':');\n    denyList.push({\n      hostname,\n      pathname\n    });\n  }\n}\n/**\n * Returns true if the right side of `domain` (end of string) matches `pattern`.\n * @param {string} pattern - a string to be matched against the end of `domain` string\n * @param {string} domain - a domain string with no protocol or path (e.g., app1.example.com)\n * @returns {boolean} `true` if domain matches pattern; else `false`\n */\nfunction domainMatchesPattern(pattern, domain) {\n  if (pattern.length > domain.length) {\n    return false;\n  }\n  return domain.indexOf(pattern) === domain.length - pattern.length;\n}\n\n/**\n * Returns true if a URL path matches a pattern string, disregarding leading slashes.\n * @param {string} pattern - a string to compare with path (e.g., api/v1)\n * @param {string} path - a string representing a URL path (e.g., /api/v1)\n * @returns {boolean} `true` if path and pattern are an exact string match (except for leading slashes); else `false`\n */\nfunction comparePath(pattern, path) {\n  if (pattern.indexOf('/') === 0) {\n    pattern = pattern.substring(1);\n  }\n  if (path.indexOf('/') === 0) {\n    path = path.substring(1);\n  }\n\n  // No path in pattern means match all paths.\n  if (pattern === '') {\n    return true;\n  }\n  return pattern === path;\n}","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as submitData from '../util/submit-data';\nimport { SharedContext } from '../context/shared-context';\nimport { Harvest } from './harvest';\nimport { subscribeToEOL } from '../unload/eol';\nimport { SESSION_EVENTS } from '../session/constants';\n\n/**\n * Periodically invokes harvest calls and handles retries\n */\nexport class HarvestScheduler extends SharedContext {\n  /**\n     * Create a HarvestScheduler\n     * @param {string} endpoint - The base BAM endpoint name -- ex. 'events'\n     * @param {object} opts - The options used to configure the HarvestScheduler\n     * @param {Function} opts.onFinished - The callback to be fired when a harvest has finished\n     * @param {Function} opts.getPayload - A callback which can be triggered to return a payload for harvesting\n     * @param {number} opts.retryDelay - The number of seconds to wait before retrying after a network failure\n     * @param {boolean} opts.raw - Use a prefabricated payload shape as the harvest payload without the need for formatting\n     * @param {string} opts.customUrl - A custom url that falls outside of the shape of the standard BAM harvester url pattern.  Will use directly instead of concatenating various pieces\n     * @param {*} parent - The parent object, whose state can be passed into SharedContext\n     */\n  constructor(endpoint, opts, parent) {\n    super(parent); // gets any allowed properties from the parent and stores them in `sharedContext`\n    this.endpoint = endpoint;\n    this.opts = opts || {};\n    this.started = false;\n    this.timeoutHandle = null;\n    this.aborted = false; // this controls the per-interval and final harvests for the scheduler (currently per feature specific!)\n\n    this.harvest = new Harvest(this.sharedContext);\n\n    // unload if EOL mechanism fires\n    subscribeToEOL(this.unload.bind(this));\n\n    /* Flush all buffered data if session resets and give up retries. This should be synchronous to ensure that the correct `session` value is sent.\n      Since session-reset generates a new session ID and the ID is grabbed at send-time, any delays or retries would cause the payload to be sent under\n      the wrong session ID. */\n    this.sharedContext?.ee.on(SESSION_EVENTS.RESET, () => this.runHarvest({\n      forceNoRetry: true\n    }));\n  }\n\n  /**\n   * This function is only meant for the last outgoing harvest cycle of a page. It trickles down to using sendBeacon, which should not be used\n   * to send payloads while the page is still active, due to limitations on how much data can be buffered in the API at any one time.\n   */\n  unload() {\n    if (this.aborted) return;\n    // If opts.onUnload is defined, these are special actions to execute before attempting to send the final payload.\n    if (this.opts.onUnload) this.opts.onUnload();\n    this.runHarvest({\n      unload: true\n    });\n  }\n  startTimer(interval, initialDelay) {\n    this.interval = interval;\n    this.started = true;\n    this.scheduleHarvest(initialDelay != null ? initialDelay : this.interval);\n  }\n  stopTimer() {\n    let permanently = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    this.aborted = permanently; // stopping permanently is same as aborting, but this function also cleans up the setTimeout loop\n    this.started = false;\n    if (this.timeoutHandle) {\n      clearTimeout(this.timeoutHandle);\n    }\n  }\n  scheduleHarvest(delay, opts) {\n    if (this.timeoutHandle) return;\n    if (delay == null) {\n      delay = this.interval;\n    }\n    this.timeoutHandle = setTimeout(() => {\n      this.timeoutHandle = null;\n      this.runHarvest(opts);\n    }, delay * 1000);\n  }\n  runHarvest(opts) {\n    if (this.aborted) return;\n\n    /**\n     * This is executed immediately after harvest sends the data via XHR, or if there's nothing to send. Note that this excludes on unloading / sendBeacon.\n     * @param {Object} result\n     */\n    const cbRanAfterSend = result => {\n      if (opts?.forceNoRetry) result.retry = false; // discard unsent data rather than re-queuing for next harvest attempt\n      this.onHarvestFinished(opts, result);\n    };\n    let harvests = [];\n    let submitMethod;\n    let payload;\n    if (this.opts.getPayload) {\n      // Ajax & PVT & SR features provide a callback function to get data for harvesting\n      submitMethod = submitData.getSubmitMethod({\n        isFinalHarvest: opts?.unload\n      });\n      if (!submitMethod) return false;\n      const retry = !opts?.unload && submitMethod === submitData.xhr;\n      payload = this.opts.getPayload({\n        retry\n      });\n      if (!payload) {\n        if (this.started) {\n          this.scheduleHarvest();\n        }\n        return;\n      }\n      payload = Object.prototype.toString.call(payload) === '[object Array]' ? payload : [payload];\n      harvests.push(...payload);\n    }\n\n    /** sendX is used for features that do not supply a preformatted payload via \"getPayload\" */\n    let send = args => this.harvest.sendX(args);\n    if (harvests.length) {\n      /** _send is the underlying method for sending in the harvest, if sending raw we can bypass the other helpers completely which format the payloads */\n      if (this.opts.raw) send = args => this.harvest._send(args);\n      /** send is used to formated the payloads from \"getPayload\" and obfuscate before sending */else send = args => this.harvest.send(args);\n    } else {\n      // force it to run at least once in sendX mode\n      harvests.push(undefined);\n    }\n    harvests.forEach(payload => {\n      send({\n        endpoint: this.endpoint,\n        payload,\n        opts,\n        submitMethod,\n        cbFinished: cbRanAfterSend,\n        customUrl: this.opts.customUrl,\n        raw: this.opts.raw\n      });\n    });\n    if (this.started) {\n      this.scheduleHarvest();\n    }\n  }\n  onHarvestFinished(opts, result) {\n    if (this.opts.onFinished) {\n      this.opts.onFinished(result);\n    }\n    if (result.sent && result.retry) {\n      const delay = result.delay || this.opts.retryDelay;\n      // reschedule next harvest if should be delayed longer\n      if (this.started && delay) {\n        clearTimeout(this.timeoutHandle);\n        this.timeoutHandle = null;\n        this.scheduleHarvest(delay, opts);\n      } else if (!this.started && delay) {\n        // if not running on a timer, schedule a single retry\n        this.scheduleHarvest(delay, opts);\n      }\n    }\n  }\n}","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { mapOwn } from '../util/map-own';\nimport { stringify } from '../util/stringify';\nimport { Obfuscator } from '../util/obfuscate';\nvar hasOwnProp = Object.prototype.hasOwnProperty;\nvar MAX_ATTRIBUTES = 64;\nexport function nullable(val, fn, comma) {\n  return val || val === 0 || val === '' ? fn(val) + (comma ? ',' : '') : '!';\n}\nexport function numeric(n, noDefault) {\n  if (noDefault) {\n    return Math.floor(n).toString(36);\n  }\n  return n === undefined || n === 0 ? '' : Math.floor(n).toString(36);\n}\nexport function getAddStringContext(agentIdentifier) {\n  // eslint-disable-next-line\n  var stringTable = Object.hasOwnProperty('create') ? Object.create(null) : {};\n  var stringTableIdx = 0;\n  return addString;\n  function addString(str) {\n    if (typeof str === 'undefined' || str === '') return '';\n    var obfuscator = new Obfuscator({\n      agentIdentifier\n    });\n    str = String(str);\n    if (obfuscator.shouldObfuscate()) str = obfuscator.obfuscateString(str);\n    if (hasOwnProp.call(stringTable, str)) {\n      return numeric(stringTable[str], true);\n    } else {\n      stringTable[str] = stringTableIdx++;\n      return quoteString(str);\n    }\n  }\n}\nexport function addCustomAttributes(attrs, addString) {\n  var attrParts = [];\n  mapOwn(attrs, function (key, val) {\n    if (attrParts.length >= MAX_ATTRIBUTES) return;\n    var type = 5;\n    var serializedValue;\n    // add key to string table first\n    key = addString(key);\n    switch (typeof val) {\n      case 'object':\n        if (val) {\n          // serialize objects to strings\n          serializedValue = addString(stringify(val));\n        } else {\n          // null attribute type\n          type = 9;\n        }\n        break;\n      case 'number':\n        type = 6;\n        // make sure numbers contain a `.` so they are parsed as doubles\n        serializedValue = val % 1 ? val : val + '.';\n        break;\n      case 'boolean':\n        type = val ? 7 : 8;\n        break;\n      case 'undefined':\n        // we treat undefined as a null attribute (since dirac does not have a concept of undefined)\n        type = 9;\n        break;\n      default:\n        serializedValue = addString(val);\n    }\n    attrParts.push([type, key + (serializedValue ? ',' + serializedValue : '')]);\n  });\n  return attrParts;\n}\nvar escapable = /([,\\\\;])/g;\nfunction quoteString(str) {\n  return \"'\" + str.replace(escapable, '\\\\$1');\n}","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// We don't use JSON.stringify directly on the performance timing data for these reasons:\n// * Chrome has extra data in the performance object that we don't want to send all the time (wasteful)\n// * Firefox fails to stringify the native object due to - http://code.google.com/p/v8/issues/detail?id=1223\n// * The variable names are long and wasteful to transmit\n\n// Add Performance Timing values to the given object.\n// * Values are written relative to an offset to reduce their length (i.e. number of characters).\n// * The offset is sent with the data\n// * 0's are not included unless the value is a 'relative zero'\n//\n\nvar START = 'Start';\nvar END = 'End';\nvar UNLOAD_EVENT = 'unloadEvent';\nvar REDIRECT = 'redirect';\nvar DOMAIN_LOOKUP = 'domainLookup';\nvar ONNECT = 'onnect';\nvar REQUEST = 'request';\nvar RESPONSE = 'response';\nvar LOAD_EVENT = 'loadEvent';\nvar DOM_CONTENT_LOAD_EVENT = 'domContentLoadedEvent';\nexport var navTimingValues = [];\nfunction getPntType(type) {\n  if (typeof type === 'number') return type;\n  const types = {\n    navigate: undefined,\n    reload: 1,\n    back_forward: 2,\n    prerender: 3\n  };\n  return types[type];\n}\nexport function addPT(offset, pt) {\n  let v = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  let isL1Api = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  if (!pt) return;\n  v.of = offset;\n  handleValue(v.of, v, 'n', true);\n  handleValue(pt[UNLOAD_EVENT + START], v, 'u', isL1Api);\n  handleValue(pt[REDIRECT + START], v, 'r', isL1Api);\n  handleValue(pt[UNLOAD_EVENT + END], v, 'ue', isL1Api);\n  handleValue(pt[REDIRECT + END], v, 're', isL1Api);\n  handleValue(pt['fetch' + START], v, 'f', isL1Api);\n  handleValue(pt[DOMAIN_LOOKUP + START], v, 'dn', isL1Api);\n  handleValue(pt[DOMAIN_LOOKUP + END], v, 'dne', isL1Api);\n  handleValue(pt['c' + ONNECT + START], v, 'c', isL1Api);\n  handleValue(pt['secureC' + ONNECT + 'ion' + START], v, 's', isL1Api);\n  handleValue(pt['c' + ONNECT + END], v, 'ce', isL1Api);\n  handleValue(pt[REQUEST + START], v, 'rq', isL1Api);\n  handleValue(pt[RESPONSE + START], v, 'rp', isL1Api);\n  handleValue(pt[RESPONSE + END], v, 'rpe', isL1Api);\n  handleValue(pt.domLoading, v, 'dl', isL1Api);\n  handleValue(pt.domInteractive, v, 'di', isL1Api);\n  handleValue(pt[DOM_CONTENT_LOAD_EVENT + START], v, 'ds', isL1Api);\n  handleValue(pt[DOM_CONTENT_LOAD_EVENT + END], v, 'de', isL1Api);\n  handleValue(pt.domComplete, v, 'dc', isL1Api);\n  handleValue(pt[LOAD_EVENT + START], v, 'l', isL1Api);\n  handleValue(pt[LOAD_EVENT + END], v, 'le', isL1Api);\n  return v;\n}\n\n// Add Performance Navigation values to the given object\nexport function addPN(pn, v) {\n  handleValue(getPntType(pn.type), v, 'ty');\n  handleValue(pn.redirectCount, v, 'rc');\n  return v;\n}\nfunction handleValue(value, obj, prop, isOldApi) {\n  /*\n  For L2 Timing API, the value will already be a relative-to-previous-document DOMHighResTimeStamp.\n  For L1 (deprecated) Timing, the value is an UNIX epoch timestamp, which we will convert to a relative time using our offset.\n  PNT.type is reported as undefined, 1, 2, etc -- note that zero-value properties will be recorded as 'undefined', however DEM interprets undefined \"types\" as \"navigate\"\n  */\n  if (typeof value === 'number' && value > 0) {\n    // note that zero-value properties will be recorded as 'undefined'\n    if (isOldApi) {\n      const offset = obj?.of > 0 ? obj.of : 0; // expect an epoch timestamp, if called by addPT\n      value = Math.max(value - offset, 0);\n    }\n    value = Math.round(value);\n    obj[prop] = value;\n  }\n  navTimingValues.push(value);\n}","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { windowAddEventListener } from '../event-listener/event-listener-opts';\nimport { globalScope, isWorkerScope, isBrowserScope } from '../constants/runtime';\nimport { subscribeToVisibilityChange } from '../window/page-visibility';\nif (isWorkerScope) {\n  globalScope.cleanupTasks = []; // create new list on WorkerGlobalScope to track funcs to run before exiting thread\n\n  const origClose = globalScope.close;\n  globalScope.close = () => {\n    // on worker's EoL signal, execute all \"listeners\", e.g. final harvests\n    for (let task of globalScope.cleanupTasks) {\n      task();\n    }\n    origClose();\n  };\n}\n\n/**\n * Subscribes a provided callback to the time/event when the agent should treat it as end-of-life.\n * This is used, for example, to submit a final harvest and send all remaining data on best-effort.\n * @param {function} cb - func to run before or during the last reliable event or time of an env's life span\n */\nexport function subscribeToEOL(cb) {\n  if (isBrowserScope) {\n    subscribeToVisibilityChange(cb, true); // when user switches tab or hides window, esp. mobile scenario\n    windowAddEventListener('pagehide', cb); // when user navigates away, and because safari iOS v14.4- doesn't fully support vis change\n    // --this ought to be removed once support for version below 14.5 phases out\n  } else if (isWorkerScope) {\n    globalScope.cleanupTasks.push(cb); // close() should run these tasks before quitting thread\n  }\n  // By default (for other env), this fn has no effect.\n}","export const VITAL_NAMES = {\n  FIRST_PAINT: 'fp',\n  FIRST_CONTENTFUL_PAINT: 'fcp',\n  FIRST_INPUT_DELAY: 'fi',\n  LARGEST_CONTENTFUL_PAINT: 'lcp',\n  CUMULATIVE_LAYOUT_SHIFT: 'cls',\n  INTERACTION_TO_NEXT_PAINT: 'inp',\n  LONG_TASK: 'lt',\n  TIME_TO_FIRST_BYTE: 'ttfb'\n};","import { onFCP } from 'web-vitals';\n// eslint-disable-next-line camelcase\nimport { iOSBelow16, initiallyHidden, isBrowserScope } from '../constants/runtime';\nimport { VITAL_NAMES } from './constants';\nimport { VitalMetric } from './vital-metric';\nexport const firstContentfulPaint = new VitalMetric(VITAL_NAMES.FIRST_CONTENTFUL_PAINT);\n\n/* First Contentful Paint - As of WV v3, it still imperfectly tries to detect document vis state asap and isn't supposed to report if page starts hidden. */\nif (isBrowserScope) {\n  // eslint-disable-next-line camelcase\n  if (iOSBelow16) {\n    try {\n      if (!initiallyHidden) {\n        // see ios-version.js for detail on this following bug case; tldr: buffered flag doesn't work but getEntriesByType does\n        const paintEntries = performance.getEntriesByType('paint');\n        paintEntries.forEach(entry => {\n          if (entry.name === 'first-contentful-paint') {\n            firstContentfulPaint.update({\n              value: Math.floor(entry.startTime),\n              entries: paintEntries\n            });\n          }\n        });\n      }\n    } catch (e) {\n      // ignore\n    }\n  } else {\n    onFCP(_ref => {\n      let {\n        value,\n        entries\n      } = _ref;\n      if (initiallyHidden || firstContentfulPaint.isValid) return;\n      firstContentfulPaint.update({\n        value,\n        entries\n      });\n    });\n  }\n}","import { initiallyHidden, isBrowserScope } from '../constants/runtime';\nimport { VITAL_NAMES } from './constants';\nimport { VitalMetric } from './vital-metric';\nexport const firstPaint = new VitalMetric(VITAL_NAMES.FIRST_PAINT);\nif (isBrowserScope) {\n  const handleEntries = entries => {\n    entries.forEach(entry => {\n      if (entry.name === 'first-paint' && !firstPaint.isValid) {\n        observer.disconnect();\n\n        /* Initial hidden state and pre-rendering not yet considered for first paint. See web-vitals onFCP for example. */\n        firstPaint.update({\n          value: entry.startTime,\n          entries\n        });\n      }\n    });\n  };\n  let observer;\n  try {\n    if (PerformanceObserver.supportedEntryTypes.includes('paint') && !initiallyHidden) {\n      observer = new PerformanceObserver(list => {\n        // Delay by a microtask to workaround a bug in Safari where the\n        // callback is invoked immediately, rather than in a separate task.\n        // See: https://github.com/GoogleChrome/web-vitals/issues/277\n        Promise.resolve().then(() => {\n          handleEntries(list.getEntries());\n        });\n      });\n      observer.observe({\n        type: 'paint',\n        buffered: true\n      });\n    }\n  } catch (e) {\n    // Do nothing.\n  }\n}","export class VitalMetric {\n  #subscribers = new Set();\n  history = [];\n  constructor(name, roundingMethod) {\n    this.name = name;\n    this.attrs = {};\n    this.roundingMethod = typeof roundingMethod === 'function' ? roundingMethod : Math.floor;\n  }\n  update(_ref) {\n    let {\n      value,\n      entries = [],\n      attrs = {}\n    } = _ref;\n    if (value < 0) return;\n    const state = {\n      value: this.roundingMethod(value),\n      name: this.name,\n      entries,\n      attrs\n    };\n    this.history.push(state);\n    this.#subscribers.forEach(cb => {\n      try {\n        cb(this.current);\n      } catch (e) {\n        // ignore errors\n      }\n    });\n  }\n  get current() {\n    return this.history[this.history.length - 1] || {\n      value: undefined,\n      name: this.name,\n      entries: [],\n      attrs: {}\n    };\n  }\n  get isValid() {\n    return this.current.value >= 0;\n  }\n  subscribe(callback) {\n    let buffered = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    if (typeof callback !== 'function') return;\n    this.#subscribers.add(callback);\n    // emit full history on subscription (\"buffered\" behavior)\n    if (this.isValid && !!buffered) this.history.forEach(state => {\n      callback(state);\n    });\n    return () => {\n      this.#subscribers.delete(callback);\n    };\n  }\n}","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nvar MAX_NODES = 128;\nvar lastId = 0;\nexport function InteractionNode(interaction, parent, type, timestamp) {\n  Object.defineProperty(this, 'interaction', {\n    value: interaction,\n    writable: true // enumerable: false -- by default, which hides this prop from obj (iterations)\n  });\n  this.parent = parent;\n  this.id = ++lastId;\n  this.type = type;\n  this.children = [];\n  this.end = null;\n  this.jsEnd = this.start = timestamp;\n  this.jsTime = 0;\n  this.attrs = {};\n  this.cancelled = false;\n}\nvar InteractionNodePrototype = InteractionNode.prototype;\n\n/**\n * @param {string} type\n * @param {number} timestamp\n * @param {string} name\n * @param {bool} dontWait - When true, the interaction will not immediately start waiting\n *                          for this node to complete. This is used when the creation of\n *                          the node and its start happen at different times (e.g. XHR).\n */\nInteractionNodePrototype.child = function child(type, timestamp, name, dontWait) {\n  var interaction = this.interaction;\n  if (interaction.end || interaction.nodes >= MAX_NODES) return null;\n  interaction.onNodeAdded(this);\n  var node = new InteractionNode(interaction, this, type, timestamp);\n  node.attrs.name = name;\n  interaction.nodes++;\n  if (!dontWait) {\n    interaction.remaining++;\n  }\n  return node;\n};\nInteractionNodePrototype.callback = function addCallbackTime(exclusiveTime, end) {\n  var node = this;\n  node.jsTime += exclusiveTime;\n  if (end > node.jsEnd) {\n    node.jsEnd = end;\n    node.interaction.lastCb = end;\n  }\n};\nInteractionNodePrototype.cancel = function cancel() {\n  this.cancelled = true;\n  var interaction = this.interaction;\n  interaction.remaining--;\n};\nInteractionNodePrototype.finish = function finish(timestamp) {\n  var node = this;\n  if (node.end) return;\n  node.end = timestamp;\n\n  // Find the next parent node that is not cancelled\n  let parent = node.parent;\n  while (parent?.cancelled) parent = parent.parent;\n\n  // Assign the node to the non-cancelled parent node\n  if (parent) parent.children.push(node);\n  node.parent = null;\n\n  // Update the interaction remaining counter\n  var interaction = this.interaction;\n  interaction.remaining--;\n  interaction.lastFinish = timestamp;\n  // check if interaction has finished, (this is needed for older browsers for unknown reasons)\n  interaction.checkFinish();\n};","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { getInfo, getRuntime, originals } from '../../../common/config/config';\nimport { mapOwn } from '../../../common/util/map-own';\nimport { ee } from '../../../common/event-emitter/contextual-ee';\nimport { InteractionNode } from './interaction-node';\nvar originalSetTimeout = originals.ST;\nvar originalClearTimeout = originals.CT;\nvar lastId = {};\nexport function Interaction(eventName, timestamp, url, routeName, onFinished, agentIdentifier) {\n  this.agentIdentifier = agentIdentifier;\n  this.ee = ee.get(agentIdentifier);\n  lastId[agentIdentifier] = 0;\n  this.id = ++lastId[agentIdentifier];\n  this.eventName = eventName;\n  this.nodes = 0;\n  this.remaining = 0;\n  this.finishTimer = null;\n  this.checkingFinish = false;\n  this.lastCb = this.lastFinish = timestamp;\n  this.handlers = [];\n  this.onFinished = onFinished;\n  this.done = false;\n  var root = this.root = new InteractionNode(this, null, 'interaction', timestamp);\n  var attrs = root.attrs;\n  attrs.trigger = eventName;\n  attrs.initialPageURL = getRuntime(agentIdentifier).origin;\n  attrs.oldRoute = routeName;\n  attrs.newURL = attrs.oldURL = url;\n  attrs.custom = {};\n  attrs.store = {};\n}\nvar InteractionPrototype = Interaction.prototype;\nInteractionPrototype.checkFinish = function checkFinish() {\n  var interaction = this;\n  if (interaction.remaining > 0) {\n    interaction._resetFinishCheck();\n    return;\n  }\n  if (interaction.checkingFinish) {\n    return;\n  }\n  if (interaction.root.end !== null) return;\n  interaction._resetFinishCheck();\n  interaction.checkingFinish = true;\n  interaction.finishTimer = originalSetTimeout(() => {\n    interaction.checkingFinish = false;\n    interaction.finishTimer = originalSetTimeout(() => {\n      interaction.finishTimer = null;\n      if (interaction.remaining <= 0) interaction.finish();\n    }, 1);\n  }, 0);\n};\nInteractionPrototype.setNewURL = function setNewURL(url) {\n  this.root.attrs.newURL = url;\n};\nInteractionPrototype.setNewRoute = function setNewRoute(route) {\n  this.root.attrs.newRoute = route;\n};\nInteractionPrototype.onNodeAdded = function onNodeAdded() {\n  this._resetFinishCheck();\n};\nInteractionPrototype._resetFinishCheck = function _resetFinishCheck() {\n  if (this.finishTimer) {\n    originalClearTimeout(this.finishTimer);\n    this.finishTimer = null;\n    this.checkingFinish = false;\n  }\n};\n\n// serialize report and remove nodes from map\nInteractionPrototype.finish = function finishInteraction() {\n  var interaction = this;\n  var root = interaction.root;\n  if (root.end !== null) return;\n  var endTimestamp = Math.max(interaction.lastCb, interaction.lastFinish);\n  var attrs = root.attrs;\n  var customAttrs = attrs.custom;\n  if (this.onFinished) {\n    this.onFinished(this);\n  }\n  mapOwn(getInfo(interaction.agentIdentifier).jsAttributes, function (attr, value) {\n    if (!(attr in customAttrs)) customAttrs[attr] = value;\n  });\n  root.end = endTimestamp;\n  interaction.ee.emit('interaction', [this]);\n};","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { cleanURL } from '../../../common/url/clean-url';\nimport { mapOwn } from '../../../common/util/map-own';\nimport { nullable, numeric, getAddStringContext, addCustomAttributes } from '../../../common/serialize/bel-serializer';\nimport { SharedContext } from '../../../common/context/shared-context';\nimport { getInfo } from '../../../common/config/config';\nexport class Serializer extends SharedContext {\n  constructor(parent) {\n    super(parent);\n\n    /**\n     * This variable is used to calculate an interactions ending offset when the\n     * harvest includes multiple interactions. This variable is set by the first\n     * interaction processed and used by subsequent interactions in the same harvest.\n     * See https://issues.newrelic.com/browse/NEWRELIC-5498\n     * @type {number|undefined}\n     */\n    this.firstTimestamp = undefined;\n  }\n  serializeMultiple(interactions, offset, navTiming) {\n    const info = getInfo(this.sharedContext.agentIdentifier);\n    var addString = getAddStringContext(this.sharedContext.agentIdentifier);\n    var serialized = 'bel.7';\n    interactions.forEach(interaction => {\n      serialized += ';' + this.serializeInteraction(interaction.root, offset, navTiming, interaction.routeChange, addString, info);\n    });\n    this.firstTimestamp = undefined;\n    return serialized;\n  }\n  serializeSingle(root, offset, navTiming, isRouteChange) {\n    const info = getInfo(this.sharedContext.agentIdentifier);\n    var addString = getAddStringContext(this.sharedContext.agentIdentifier);\n    var serialized = 'bel.7;' + this.serializeInteraction(root, offset, navTiming, isRouteChange, addString, info);\n    this.firstTimestamp = undefined;\n    return serialized;\n  }\n  serializeInteraction(root, offset, navTiming, isRouteChange, addString, info) {\n    offset = offset || 0;\n    var isInitialPage = root.attrs.trigger === 'initialPageLoad';\n    var typeIdsByName = {\n      interaction: 1,\n      ajax: 2,\n      customTracer: 4\n    };\n\n    // Include the hash fragment with all SPA data\n    var includeHashFragment = true;\n    const addNode = (node, nodeList) => {\n      if (node.type === 'customEnd') return nodeList.push([3, numeric(node.end - this.firstTimestamp)]);\n      var typeName = node.type;\n      var typeId = typeIdsByName[typeName];\n      var startTimestamp = node.start;\n      var childCount = node.children.length;\n      var attrCount = 0;\n      var apmAttributes = info.atts;\n      var hasNavTiming = isInitialPage && navTiming.length && typeId === 1;\n      var children = [];\n      var attrs = node.attrs;\n      var metrics = attrs.metrics;\n      var params = attrs.params;\n      var queueTime = info.queueTime;\n      var appTime = info.applicationTime;\n      if (typeof this.firstTimestamp === 'undefined') {\n        startTimestamp += offset;\n        this.firstTimestamp = startTimestamp;\n      } else {\n        startTimestamp -= this.firstTimestamp;\n      }\n      var fields = [numeric(startTimestamp), numeric(node.end - node.start), numeric(node.jsEnd - node.end), numeric(node.jsTime)];\n      switch (typeId) {\n        case 1:\n          fields[2] = numeric(node.jsEnd - this.firstTimestamp);\n          fields.push(addString(attrs.trigger), addString(cleanURL(attrs.initialPageURL, includeHashFragment)), addString(cleanURL(attrs.oldURL, includeHashFragment)), addString(cleanURL(attrs.newURL, includeHashFragment)), addString(attrs.customName), isInitialPage ? '' : isRouteChange ? 1 : 2, nullable(isInitialPage && queueTime, numeric, true) + nullable(isInitialPage && appTime, numeric, true) + nullable(attrs.oldRoute, addString, true) + nullable(attrs.newRoute, addString, true) + addString(attrs.id), addString(node.id), nullable(attrs.firstPaint, numeric, true) + nullable(attrs.firstContentfulPaint, numeric, false));\n          var attrParts = addCustomAttributes(attrs.custom, addString);\n          children = children.concat(attrParts);\n          attrCount = attrParts.length;\n          if (apmAttributes) {\n            childCount++;\n            children.push('a,' + addString(apmAttributes));\n          }\n          break;\n        case 2:\n          fields.push(addString(params.method), numeric(params.status), addString(params.host), addString(params.pathname), numeric(metrics.txSize), numeric(metrics.rxSize), attrs.isFetch ? 1 : attrs.isJSONP ? 2 : '', addString(node.id), nullable(node.dt && node.dt.spanId, addString, true) + nullable(node.dt && node.dt.traceId, addString, true) + nullable(node.dt && node.dt.timestamp, numeric, false));\n\n          // add params.gql here\n          if (Object.keys(params?.gql || {}).length) {\n            var ajaxAttrParts = addCustomAttributes(params.gql, addString);\n            children = children.concat(ajaxAttrParts);\n            attrCount = ajaxAttrParts.length;\n          }\n          break;\n        case 4:\n          var tracedTime = attrs.tracedTime;\n          fields.push(addString(attrs.name), nullable(tracedTime, numeric, true) + addString(node.id));\n          break;\n      }\n      for (var i = 0; i < node.children.length; i++) {\n        addNode(node.children[i], children);\n      }\n      fields.unshift(numeric(typeId), numeric(childCount += attrCount));\n      nodeList.push(fields);\n      if (childCount) {\n        nodeList.push(children.join(';'));\n      }\n      if (hasNavTiming) {\n        // this build up the navTiming node\n        // it for each navTiming value (pre aggregated in nav-timing.js):\n        // we initialize the seperator to ',' (seperates the nodeType id from the first value)\n        // we initialize the navTiming node to 'b' (the nodeType id)\n        // if the value is present:\n        //   we add the seperator followed by the value\n        // otherwise\n        //   we add null seperator ('!') to the navTimingNode\n        //   we set the seperator to an empty string since we already wrote it above\n        //   the reason for writing the null seperator instead of setting the seperator\n        //   is to ensure we still write it if the null is the last navTiming value.\n\n        var seperator = ',';\n        var navTimingNode = 'b';\n        var prev = 0;\n\n        // get all navTiming values except navigationStart\n        // (since its the same as interaction.start)\n        // and limit to just the first 20 values we know about\n        mapOwn(navTiming.slice(1, 21), function (i, v) {\n          if (v !== undefined) {\n            navTimingNode += seperator + numeric(v - prev);\n            seperator = ',';\n            prev = v;\n          } else {\n            navTimingNode += seperator + '!';\n            seperator = '';\n          }\n        });\n        nodeList.push(navTimingNode);\n      } else if (typeId === 1) {\n        nodeList.push('');\n      }\n      return nodeList;\n    };\n    return addNode(root, []).join(';');\n  }\n}","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n/* eslint no-undef: \"error\" */\nimport { registerHandler as register } from '../../../common/event-emitter/register-handler';\nimport { parseUrl } from '../../../common/url/parse-url';\nimport { shouldCollectEvent } from '../../../common/deny-list/deny-list';\nimport { mapOwn } from '../../../common/util/map-own';\nimport { navTimingValues as navTiming } from '../../../common/timing/nav-timing';\nimport { generateUuid } from '../../../common/ids/unique-id';\nimport { Interaction } from './interaction';\nimport { getConfigurationValue, getRuntime } from '../../../common/config/config';\nimport { eventListenerOpts } from '../../../common/event-listener/event-listener-opts';\nimport { HarvestScheduler } from '../../../common/harvest/harvest-scheduler';\nimport { Serializer } from './serializer';\nimport { ee } from '../../../common/event-emitter/contextual-ee';\nimport * as CONSTANTS from '../constants';\nimport { FEATURE_NAMES } from '../../../loaders/features/features';\nimport { AggregateBase } from '../../utils/aggregate-base';\nimport { firstContentfulPaint } from '../../../common/vitals/first-contentful-paint';\nimport { firstPaint } from '../../../common/vitals/first-paint';\nimport { bundleId } from '../../../common/ids/bundle-id';\nimport { loadedAsDeferredBrowserScript } from '../../../common/constants/runtime';\nimport { handle } from '../../../common/event-emitter/handle';\nimport { SUPPORTABILITY_METRIC_CHANNEL } from '../../metrics/constants';\nconst {\n  FEATURE_NAME,\n  INTERACTION_EVENTS,\n  MAX_TIMER_BUDGET,\n  FN_START,\n  FN_END,\n  CB_START,\n  INTERACTION_API,\n  REMAINING,\n  INTERACTION,\n  SPA_NODE,\n  JSONP_NODE,\n  FETCH_START,\n  FETCH_DONE,\n  FETCH_BODY,\n  JSONP_END,\n  originalSetTimeout\n} = CONSTANTS;\nexport class Aggregate extends AggregateBase {\n  static featureName = FEATURE_NAME;\n  constructor(agentIdentifier, aggregator) {\n    super(agentIdentifier, aggregator, FEATURE_NAME);\n    this.state = {\n      initialPageURL: getRuntime(agentIdentifier).origin,\n      lastSeenUrl: getRuntime(agentIdentifier).origin,\n      lastSeenRouteName: null,\n      timerMap: {},\n      timerBudget: MAX_TIMER_BUDGET,\n      currentNode: null,\n      prevNode: null,\n      nodeOnLastHashUpdate: null,\n      initialPageLoad: null,\n      pageLoaded: false,\n      childTime: 0,\n      depth: 0,\n      harvestTimeSeconds: getConfigurationValue(agentIdentifier, 'spa.harvestTimeSeconds') || 10,\n      interactionsToHarvest: [],\n      interactionsSent: [],\n      // The below feature flag is used to disable the SPA ajax fix for specific customers, see https://new-relic.atlassian.net/browse/NR-172169\n      disableSpaFix: (getConfigurationValue(agentIdentifier, 'feature_flags') || []).indexOf('disable-spa-fix') > -1\n    };\n    this.serializer = new Serializer(this);\n    const {\n      state,\n      serializer\n    } = this;\n    let {\n      blocked\n    } = this;\n    const baseEE = ee.get(agentIdentifier); // <-- parent baseEE\n    const mutationEE = baseEE.get('mutation');\n    const promiseEE = baseEE.get('promise');\n    const historyEE = baseEE.get('history');\n    const eventsEE = baseEE.get('events'); // ajax --> ee(123).emit() ee()\n    const timerEE = baseEE.get('timer');\n    const fetchEE = baseEE.get('fetch');\n    const jsonpEE = baseEE.get('jsonp');\n    const xhrEE = baseEE.get('xhr');\n    const tracerEE = baseEE.get('tracer');\n    const scheduler = new HarvestScheduler('events', {\n      onFinished: onHarvestFinished,\n      retryDelay: state.harvestTimeSeconds\n    }, {\n      agentIdentifier,\n      ee: baseEE\n    });\n    scheduler.harvest.on('events', onHarvestStarted);\n\n    // childTime is used when calculating exclusive time for a cb duration.\n    //\n    // Exclusive time will be different than the total time for either callbacks\n    // which synchronously invoke a customTracer callback or, trigger a synchronous\n    // event (eg. onreadystate=1 or popstate).\n    //\n    // At fn-end, childTime will contain the total time of all timed callbacks and\n    // event handlers which executed as a child of the current callback. At the\n    // begining of every callback, childTime is saved to the event context (which at\n    // that time contains the sum of its preceeding siblings) and is reset to 0. The\n    // callback is then executed, and its children may increase childTime.  At the\n    // end of the callback, it reports its exclusive time as its\n    // execution time - exlcuded. childTime is then reset to its previous\n    // value, and the totalTime of the callback that just finished executing is\n    // added to the childTime time.\n    //                                    | clock | childTime | ctx.ct | totalTime | exclusive |\n    // click fn-start                     |   0   |    0     |    0   |           |           |\n    //  | click begining:                 |   5   |    0     |    0   |           |           |\n    //  |   | custom-1 fn-start           |   10  |    0     |    0   |           |           |\n    //  |   |   |  custom-1 begining      |   15  |    0     |    0   |           |           |\n    //  |   |   |    |  custom-2 fn-start |   20  |    0     |    0   |           |           |\n    //  |   |   |    |  | custom-2        |   25  |    0     |    0   |           |           |\n    //  |   |   |    |  custom-2 fn-end   |   30  |    10    |    0   |     10    |     10    |\n    //  |   |   |  custom-1 middle        |   35  |    10    |    0   |           |           |\n    //  |   |   |    |  custom-3 fn-start |   40  |    0     |    10  |           |           |\n    //  |   |   |    |  | custom-3        |   45  |    0     |    10  |           |           |\n    //  |   |   |    |  custom-3 fn-end   |   50  |    20    |    0   |     10    |     10    |\n    //  |   |   |  custom-1 ending        |   55  |    20    |    0   |           |           |\n    //  |     custom-1 fn-end             |   60  |    50    |    0   |     50    |     30    |\n    //  | click ending:                   |   65  |    50    |        |           |           |\n    // click fn-end                       |   70  |    0     |    0   |     70    |     20    |\n\n    // if rum response determines that customer lacks entitlements for spa endpoint, block it\n    register('block-spa', () => {\n      blocked = true;\n      scheduler.stopTimer(true);\n    }, this.featureName, baseEE);\n    if (!isEnabled()) return;\n    state.initialPageLoad = new Interaction('initialPageLoad', 0, state.lastSeenUrl, state.lastSeenRouteName, onInteractionFinished, agentIdentifier);\n    state.initialPageLoad.save = true;\n    state.prevInteraction = state.initialPageLoad;\n    state.currentNode = state.initialPageLoad.root; // hint\n    // ensure that checkFinish calls are safe during initialPageLoad\n    state.initialPageLoad[REMAINING]++;\n    register(FN_START, callbackStart, this.featureName, baseEE);\n    register(CB_START, callbackStart, this.featureName, promiseEE);\n\n    // register plugins\n    var pluginApi = {\n      getCurrentNode,\n      setCurrentNode\n    };\n    register('spa-register', function (init) {\n      if (typeof init === 'function') {\n        init(pluginApi);\n      }\n    }, FEATURE_NAMES.spa, baseEE);\n    function callbackStart() {\n      state.depth++;\n      this.prevNode = state.currentNode;\n      this.ct = state.childTime;\n      state.childTime = 0;\n      state.timerBudget = MAX_TIMER_BUDGET;\n    }\n    register(FN_END, callbackEnd, this.featureName, baseEE);\n    register('cb-end', callbackEnd, this.featureName, promiseEE);\n    function callbackEnd() {\n      state.depth--;\n      var totalTime = this.jsTime || 0;\n      var exclusiveTime = totalTime - state.childTime;\n      state.childTime = this.ct + totalTime;\n      if (state.currentNode) {\n        // transfer accumulated callback time to the active interaction node\n        // run even if jsTime is 0 to update jsEnd\n        state.currentNode.callback(exclusiveTime, this[FN_END]);\n        if (this.isTraced) {\n          state.currentNode.attrs.tracedTime = exclusiveTime;\n        }\n      }\n      this.jsTime = state.currentNode ? 0 : exclusiveTime;\n      setCurrentNode(this.prevNode);\n      this.prevNode = null;\n      state.timerBudget = MAX_TIMER_BUDGET;\n    }\n    register(FN_START, function (args, eventSource) {\n      var ev = args[0];\n      var evName = ev.type;\n      var eventNode = ev[\"__nrNode:\".concat(bundleId)];\n      if (!state.pageLoaded && (evName === 'load' && eventSource === window || loadedAsDeferredBrowserScript)) {\n        state.pageLoaded = true;\n        // set to null so prevNode is set correctly\n        this.prevNode = state.currentNode = null;\n        if (state.initialPageLoad) {\n          eventNode = state.initialPageLoad.root;\n\n          // Even if initialPageLoad has remaining callbacks, force the initialPageLoad\n          // interaction to complete when the page load event occurs.\n          state.initialPageLoad[REMAINING] = 0;\n          originalSetTimeout(function () {\n            INTERACTION_EVENTS.push('popstate');\n          });\n        }\n      }\n      if (eventNode) {\n        // If we've already seen a previous handler for this specific event object,\n        // just restore that. We want multiple handlers for the same event to share\n        // a node.\n        setCurrentNode(eventNode);\n      } else if (evName === 'hashchange') {\n        setCurrentNode(state.nodeOnLastHashUpdate);\n        state.nodeOnLastHashUpdate = null;\n      } else if (eventSource instanceof XMLHttpRequest) {\n        // If this event was emitted by an XHR, restore the node ID associated with\n        // that XHR.\n        setCurrentNode(baseEE.context(eventSource).spaNode);\n      } else if (!state.currentNode && INTERACTION_EVENTS.indexOf(evName) !== -1) {\n        // Otherwise, if no interaction is currently active, create a new node ID,\n        // and let the aggregator know that we entered a new event handler callback\n        // so that it has a chance to possibly start an interaction.\n        var ixn = new Interaction(evName, this[FN_START], state.lastSeenUrl, state.lastSeenRouteName, onInteractionFinished, agentIdentifier);\n\n        // Store the interaction as prevInteraction in case it is prematurely discarded\n        state.prevInteraction = ixn;\n        setCurrentNode(ixn.root);\n        if (evName === 'click') {\n          var value = getActionText(ev.target);\n          if (value) {\n            state.currentNode.attrs.custom.actionText = value;\n          }\n        }\n      }\n      ev[\"__nrNode:\".concat(bundleId)] = state.currentNode;\n    }, this.featureName, eventsEE);\n\n    /**\n     * *** TIMERS ***\n     * setTimeout call needs to keep the interaction active in case a node is started\n     * in its callback.\n     */\n\n    // The context supplied to this callback will be shared with the fn-start/fn-end\n    // callbacks that fire around the callback passed to setTimeout originally.\n    register('setTimeout-end', function saveId(args, obj, timerId) {\n      if (!state.currentNode || state.timerBudget - this.timerDuration < 0) return;\n      if (args && !(args[0] instanceof Function)) return;\n      state.currentNode[INTERACTION][REMAINING]++;\n      this.timerId = timerId;\n      state.timerMap[timerId] = state.currentNode;\n      this.timerBudget = state.timerBudget - 50;\n    }, this.featureName, timerEE);\n    register('clearTimeout-start', function clear(args) {\n      var timerId = args[0];\n      var node = state.timerMap[timerId];\n      if (node) {\n        var interaction = node[INTERACTION];\n        interaction[REMAINING]--;\n        interaction.checkFinish();\n        delete state.timerMap[timerId];\n      }\n    }, this.featureName, timerEE);\n    register(FN_START, function () {\n      state.timerBudget = this.timerBudget || MAX_TIMER_BUDGET;\n      var id = this.timerId;\n      var node = state.timerMap[id];\n      setCurrentNode(node);\n      delete state.timerMap[id];\n      if (node) node[INTERACTION][REMAINING]--;\n    }, this.featureName, timerEE);\n\n    /**\n     * *** XHR ***\n     * - `new-xhr` event is fired when new instance of XHR is created. Here we create\n     *    a new node and store it on the XHR object.\n     * -  When the send method is called (`send-xhr-start` event), we tell the interaction\n     *    to wait for this XHR to complete.\n     * -  When any direct event handlers are invoked (`fn-start` on the `xhr` emitter),\n     *    we restore the node in case other child nodes are started here.\n     * -  Callbacks attached using `addEventListener` are handled using `fn-start` on the\n     *    `events` emitter.\n     * -  When `xhr-resolved` is emitted, we end the node. The node.finish() call also\n     *    instructs the interaction to stop waiting for this node.\n     */\n\n    // context is shared with new-xhr event, and is stored on the xhr iteself.\n    register(FN_START, function () {\n      setCurrentNode(this[SPA_NODE]);\n    }, this.featureName, xhrEE);\n\n    // context is stored on the xhr and is shared with all callbacks associated\n    // with the new xhr\n    register('new-xhr', function () {\n      if (!state.disableSpaFix && !state.currentNode && state.prevInteraction && !state.prevInteraction.ignored) {\n        /*\n         * The previous interaction was discarded before a route change. Restore the interaction\n         * in case this XHR is associated with a route change.\n         */\n        const interaction = state.prevInteraction;\n        state.currentNode = interaction.root;\n        interaction.root.end = null;\n      }\n      if (state.currentNode) {\n        this[SPA_NODE] = state.currentNode.child('ajax', null, null, true);\n      }\n    }, this.featureName, xhrEE);\n    register('send-xhr-start', function () {\n      var node = this[SPA_NODE];\n      if (node && !this.sent) {\n        this.sent = true;\n        node.dt = this.dt;\n        node.jsEnd = node.start = this.startTime;\n        node[INTERACTION][REMAINING]++;\n      }\n    }, this.featureName, xhrEE);\n    register('xhr-resolved', function () {\n      var node = this[SPA_NODE];\n      if (node) {\n        if (!shouldCollectEvent(this.params)) {\n          node.cancel();\n          return;\n        }\n        var attrs = node.attrs;\n        attrs.params = this.params;\n        attrs.metrics = this.metrics;\n        node.finish(this.endTime);\n        if (!!this.currentNode && !!this.currentNode.interaction) this.currentNode.interaction.checkFinish();\n      }\n    }, this.featureName, baseEE);\n\n    /**\n     * *** JSONP ***\n     *\n     */\n\n    register('new-jsonp', function (url) {\n      if (state.currentNode) {\n        var node = this[JSONP_NODE] = state.currentNode.child('ajax', this[FETCH_START]);\n        node.start = this['new-jsonp'];\n        this.url = url;\n        this.status = null;\n      }\n    }, this.featureName, jsonpEE);\n    register('cb-start', function (args) {\n      var node = this[JSONP_NODE];\n      if (node) {\n        setCurrentNode(node);\n        this.status = 200;\n      }\n    }, this.featureName, jsonpEE);\n    register('jsonp-error', function () {\n      var node = this[JSONP_NODE];\n      if (node) {\n        setCurrentNode(node);\n        this.status = 0;\n      }\n    }, this.featureName, jsonpEE);\n    register(JSONP_END, function () {\n      var node = this[JSONP_NODE];\n      if (node) {\n        // if no status is set then cb never fired - so it's not a valid JSONP\n        if (this.status === null) {\n          node.cancel();\n          return;\n        }\n        var attrs = node.attrs;\n        var params = attrs.params = {};\n        var parsed = parseUrl(this.url);\n        params.method = 'GET';\n        params.pathname = parsed.pathname;\n        params.host = parsed.hostname + ':' + parsed.port;\n        params.status = this.status;\n        attrs.metrics = {\n          txSize: 0,\n          rxSize: 0\n        };\n        attrs.isJSONP = true;\n        node.jsEnd = this[JSONP_END];\n        node.jsTime = this[CB_START] ? this[JSONP_END] - this[CB_START] : 0;\n        node.finish(node.jsEnd);\n      }\n    }, this.featureName, jsonpEE);\n    register(FETCH_START, function (fetchArguments, dtPayload) {\n      if (fetchArguments) {\n        if (!state.disableSpaFix && !state.currentNode && state.prevInteraction && !state.prevInteraction.ignored) {\n          /*\n           * The previous interaction was discarded before a route change. Restore the interaction\n           * in case this XHR is associated with a route change.\n           */\n          const interaction = state.prevInteraction;\n          state.currentNode = interaction.root;\n          interaction.root.end = null;\n        }\n        if (state.currentNode) {\n          this[SPA_NODE] = state.currentNode.child('ajax', this[FETCH_START]);\n          if (dtPayload && this[SPA_NODE]) this[SPA_NODE].dt = dtPayload;\n        }\n      }\n    }, this.featureName, fetchEE);\n    register(FETCH_BODY + 'start', function (args) {\n      if (state.currentNode) {\n        this[SPA_NODE] = state.currentNode;\n        state.currentNode[INTERACTION][REMAINING]++;\n      }\n    }, this.featureName, fetchEE);\n    register(FETCH_BODY + 'end', function (args, ctx, bodyPromise) {\n      var node = this[SPA_NODE];\n      if (node) node[INTERACTION][REMAINING]--;\n    }, this.featureName, fetchEE);\n    register(FETCH_DONE, function (err, res) {\n      var node = this[SPA_NODE];\n      if (node) {\n        if (err || !shouldCollectEvent(this.params)) {\n          node.cancel();\n          return;\n        }\n        var attrs = node.attrs;\n        attrs.params = this.params;\n        attrs.metrics = {\n          txSize: this.txSize,\n          rxSize: this.rxSize\n        };\n        attrs.isFetch = true;\n        node.finish(this[FETCH_DONE]);\n      }\n    }, this.featureName, fetchEE);\n    register('newURL', function (url, hashChangedDuringCb) {\n      if (state.currentNode) {\n        state.currentNode[INTERACTION].setNewURL(url);\n      } else if (state.prevInteraction && !state.prevInteraction.ignored) {\n        /*\n         * The previous interaction was discarded before the route was changed. This can happen in SPA\n         * frameworks when using lazy loading. We have also seen this in version 11+ of Nextjs where\n         * some route changes re-use cached resolved promises.\n         */\n        const interaction = state.prevInteraction;\n        interaction.setNewURL(url);\n        interaction.root.end = null;\n        setCurrentNode(interaction.root);\n      }\n      if (state.currentNode) {\n        if (state.lastSeenUrl !== url) {\n          state.currentNode[INTERACTION].routeChange = true;\n        }\n        if (hashChangedDuringCb) {\n          state.nodeOnLastHashUpdate = state.currentNode;\n        }\n      }\n      state.lastSeenUrl = url;\n    }, this.featureName, historyEE);\n\n    /**\n     * SCRIPTS\n     *   This is only needed to keep the interaction open while external scripts are being loaded.\n     *   The script that is loaded could continue the interaction by making additional AJAX\n     *   calls or changing the URL. The interaction context (currentNode) needs to be\n     *   restored somehow, but this differs based on the specific customer code. In some cases, we\n     *   could wrap a JSONP callback, in other cases we could wrap a higher-level API, and in\n     *   some cases we may not be able to restore context automatically (customer would need\n     *   to instrument their code manually).\n     *\n     * - We do not restore the original context in the load/error callbacks. This would not\n     *   work for the scripts themselves because by the time the load event fires, the\n     *   script content has already been executed.\n     */\n\n    // dom-start is emitted when appendChild or replaceChild are called. If the element being\n    // inserted is script and we are inside an interaction, we will keep the interaction open\n    // until the script is loaded.\n    jsonpEE.on('dom-start', function (args) {\n      if (!state.currentNode) return;\n      var el = args[0];\n      var isScript = el && el.nodeName === 'SCRIPT' && el.src !== '';\n      var interaction = state.currentNode.interaction;\n      if (isScript) {\n        // increase remaining count to keep the interaction open\n        interaction[REMAINING]++;\n        el.addEventListener('load', onload, eventListenerOpts(false));\n        el.addEventListener('error', onerror, eventListenerOpts(false));\n      }\n      function onload() {\n        // decrease remaining to allow interaction to finish\n        interaction[REMAINING]--;\n\n        // checkFinish is what initiates closing interaction, but is only called\n        // when setCurrentNode is called. Since we are not restoring a node here,\n        // we need to initiate the check manually.\n        // The reason we are not restoring the node here is because 1) this is not\n        // where the code of the external script runs (by the time the load event\n        // fires, it has already executed), and 2) it would require storing the context\n        // probably on the DOM node and restoring in all callbacks, which is a different\n        // use case than lazy loading.\n        interaction.checkFinish();\n      }\n      function onerror() {\n        interaction[REMAINING]--;\n        interaction.checkFinish();\n      }\n    });\n    register(FN_START, function () {\n      setCurrentNode(state.prevNode);\n    }, this.featureName, mutationEE);\n    register('resolve-start', resolvePromise, this.featureName, promiseEE);\n    register('executor-err', resolvePromise, this.featureName, promiseEE);\n    register('propagate', saveNode, this.featureName, promiseEE);\n    register(CB_START, function () {\n      var ctx = this.getCtx ? this.getCtx() : this;\n      setCurrentNode(ctx[SPA_NODE]);\n    }, this.featureName, promiseEE);\n    register(INTERACTION_API + 'get', function (t) {\n      var interaction;\n      if (state?.currentNode?.[INTERACTION]) interaction = this.ixn = state.currentNode[INTERACTION];else if (state?.prevNode?.end === null && state?.prevNode?.[INTERACTION]?.root?.[INTERACTION]?.eventName !== 'initialPageLoad') interaction = this.ixn = state.prevNode[INTERACTION];else interaction = this.ixn = new Interaction('api', t, state.lastSeenUrl, state.lastSeenRouteName, onInteractionFinished, agentIdentifier);\n      if (!state.currentNode) {\n        interaction.checkFinish();\n        if (state.depth) setCurrentNode(interaction.root);\n      }\n    }, this.featureName, baseEE);\n    register(INTERACTION_API + 'actionText', function (t, actionText) {\n      var customAttrs = this.ixn.root.attrs.custom;\n      if (actionText) customAttrs.actionText = actionText;\n    }, this.featureName, baseEE);\n    register(INTERACTION_API + 'setName', function (t, name, trigger) {\n      var attrs = this.ixn.root.attrs;\n      if (name) attrs.customName = name;\n      if (trigger) attrs.trigger = trigger;\n    }, this.featureName, baseEE);\n    register(INTERACTION_API + 'setAttribute', function (t, name, value) {\n      this.ixn.root.attrs.custom[name] = value;\n    }, this.featureName, baseEE);\n    register(INTERACTION_API + 'end', function (timestamp) {\n      var interaction = this.ixn;\n      var node = activeNodeFor(interaction);\n      setCurrentNode(null);\n      node.child('customEnd', timestamp).finish(timestamp);\n      interaction.finish();\n    }, this.featureName, baseEE);\n    register(INTERACTION_API + 'ignore', function (t) {\n      this.ixn.ignored = true;\n    }, this.featureName, baseEE);\n    register(INTERACTION_API + 'save', function (t) {\n      this.ixn.save = true;\n    }, this.featureName, baseEE);\n    register(INTERACTION_API + 'tracer', function (timestamp, name, store) {\n      var interaction = this.ixn;\n      var parent = activeNodeFor(interaction);\n      var ctx = baseEE.context(store);\n      if (!name) {\n        ctx.inc = ++interaction[REMAINING];\n        return ctx[SPA_NODE] = parent;\n      }\n      ctx[SPA_NODE] = parent.child('customTracer', timestamp, name);\n    }, this.featureName, baseEE);\n    register(FN_START, tracerDone, this.featureName, tracerEE);\n    register('no-' + FN_START, tracerDone, this.featureName, tracerEE);\n    function tracerDone(timestamp, interactionContext, hasCb) {\n      var node = this[SPA_NODE];\n      if (!node) return;\n      var interaction = node[INTERACTION];\n      var inc = this.inc;\n      this.isTraced = true;\n      if (inc) {\n        interaction[REMAINING]--;\n      } else if (node) {\n        node.finish(timestamp);\n      }\n      hasCb ? setCurrentNode(node) : interaction.checkFinish();\n    }\n    register(INTERACTION_API + 'getContext', function (t, cb) {\n      var store = this.ixn.root.attrs.store;\n      setTimeout(function () {\n        cb(store);\n      }, 0);\n    }, this.featureName, baseEE);\n    register(INTERACTION_API + 'onEnd', function (t, cb) {\n      this.ixn.handlers.push(cb);\n    }, this.featureName, baseEE);\n    register('api-routeName', function (t, currentRouteName) {\n      state.lastSeenRouteName = currentRouteName;\n      if (state.currentNode) state.currentNode[INTERACTION].setNewRoute(currentRouteName);\n    }, this.featureName, baseEE);\n    function activeNodeFor(interaction) {\n      return state.currentNode && state.currentNode[INTERACTION] === interaction ? state.currentNode : interaction.root;\n    }\n    function saveNode(val, overwrite) {\n      if (overwrite || !this[SPA_NODE]) this[SPA_NODE] = state.currentNode;\n    }\n    function resolvePromise() {\n      if (!this.resolved) {\n        this.resolved = true;\n        this[SPA_NODE] = state.currentNode;\n      }\n    }\n    function getCurrentNode() {\n      return state.currentNode;\n    }\n    function setCurrentNode(newNode) {\n      if (!state.pageLoaded && !newNode && state.initialPageLoad) newNode = state.initialPageLoad.root;\n      if (state.currentNode) {\n        state.currentNode[INTERACTION].checkFinish();\n      }\n      state.prevNode = state.currentNode;\n      state.currentNode = newNode && !newNode[INTERACTION].root.end ? newNode : null;\n    }\n    function onInteractionFinished(interaction) {\n      if (interaction === state.initialPageLoad) state.initialPageLoad = null;\n      var root = interaction.root;\n      var attrs = root.attrs;\n\n      // make sure that newrelic[INTERACTION]() works in end handler\n      state.currentNode = root;\n      mapOwn(interaction.handlers, function (i, cb) {\n        cb(attrs.store);\n      });\n      setCurrentNode(null);\n    }\n    function onHarvestStarted(options) {\n      if (state.interactionsToHarvest.length === 0 || blocked) return {};\n      var payload = serializer.serializeMultiple(state.interactionsToHarvest, 0, navTiming);\n      if (options.retry) {\n        state.interactionsToHarvest.forEach(function (interaction) {\n          state.interactionsSent.push(interaction);\n        });\n      }\n      state.interactionsToHarvest = [];\n      return {\n        body: {\n          e: payload\n        }\n      };\n    }\n    function onHarvestFinished(result) {\n      if (result.sent && result.retry && state.interactionsSent.length > 0) {\n        state.interactionsSent.forEach(function (interaction) {\n          state.interactionsToHarvest.unshift(interaction);\n        });\n        state.interactionsSent = [];\n      }\n    }\n    baseEE.on('errorAgg', function (type, name, params, metrics) {\n      if (!state.currentNode) return;\n      params._interactionId = state.currentNode.interaction.id;\n      // do not capture parentNodeId when in root node\n      if (state.currentNode.type && state.currentNode.type !== 'interaction') {\n        params._interactionNodeId = state.currentNode.id;\n      }\n    });\n    baseEE.on('interaction', saveInteraction);\n    function getActionText(node) {\n      var nodeType = node.tagName.toLowerCase();\n      var goodNodeTypes = ['a', 'button', 'input'];\n      var isGoodNode = goodNodeTypes.indexOf(nodeType) !== -1;\n      if (isGoodNode) {\n        return node.title || node.value || node.innerText;\n      }\n    }\n    function saveInteraction(interaction) {\n      if (interaction.ignored || !interaction.save && !interaction.routeChange) {\n        baseEE.emit('interactionDiscarded', [interaction]);\n        return;\n      }\n      if (state.prevInteraction === interaction) {\n        // If the interaction is being saved, remove it from prevInteraction variable\n        // to prevent the interaction from possibly being sent twice or causing an internal\n        // recursive loop issue.\n        state.prevInteraction = null;\n      }\n\n      // assign unique id, this is serialized and used to link interactions with errors\n      interaction.root.attrs.id = generateUuid();\n      if (interaction.root.attrs.trigger === 'initialPageLoad') {\n        interaction.root.attrs.firstPaint = firstPaint.current.value;\n        interaction.root.attrs.firstContentfulPaint = firstContentfulPaint.current.value;\n      }\n      baseEE.emit('interactionSaved', [interaction]);\n      state.interactionsToHarvest.push(interaction);\n      let smCategory = 'RouteChange';\n      if (interaction.root?.attrs?.trigger === 'initialPageLoad') smCategory = 'InitialPageLoad';else if (interaction.root?.attrs?.trigger === 'api') smCategory = 'Custom';\n      handle(SUPPORTABILITY_METRIC_CHANNEL, [\"Spa/Interaction/\".concat(smCategory, \"/Duration/Ms\"), Math.max((interaction.root?.end || 0) - (interaction.root?.start || 0), 0)], undefined, FEATURE_NAMES.metrics, baseEE);\n      scheduler.scheduleHarvest(0);\n    }\n    function isEnabled() {\n      var enabled = getConfigurationValue(agentIdentifier, 'spa.enabled');\n      return enabled !== false;\n    }\n    this.drain();\n  }\n}","var e,n,t,i,r,a=-1,o=function(e){addEventListener(\"pageshow\",(function(n){n.persisted&&(a=n.timeStamp,e(n))}),!0)},c=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType(\"navigation\")[0]},u=function(){var e=c();return e&&e.activationStart||0},f=function(e,n){var t=c(),i=\"navigate\";a>=0?i=\"back-forward-cache\":t&&(document.prerendering||u()>0?i=\"prerender\":document.wasDiscarded?i=\"restore\":t.type&&(i=t.type.replace(/_/g,\"-\")));return{name:e,value:void 0===n?-1:n,rating:\"good\",delta:0,entries:[],id:\"v3-\".concat(Date.now(),\"-\").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:i}},s=function(e,n,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var i=new PerformanceObserver((function(e){Promise.resolve().then((function(){n(e.getEntries())}))}));return i.observe(Object.assign({type:e,buffered:!0},t||{})),i}}catch(e){}},d=function(e,n,t,i){var r,a;return function(o){n.value>=0&&(o||i)&&((a=n.value-(r||0))||void 0===r)&&(r=n.value,n.delta=a,n.rating=function(e,n){return e>n[1]?\"poor\":e>n[0]?\"needs-improvement\":\"good\"}(n.value,t),e(n))}},l=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},p=function(e){var n=function(n){\"pagehide\"!==n.type&&\"hidden\"!==document.visibilityState||e(n)};addEventListener(\"visibilitychange\",n,!0),addEventListener(\"pagehide\",n,!0)},v=function(e){var n=!1;return function(t){n||(e(t),n=!0)}},m=-1,h=function(){return\"hidden\"!==document.visibilityState||document.prerendering?1/0:0},g=function(e){\"hidden\"===document.visibilityState&&m>-1&&(m=\"visibilitychange\"===e.type?e.timeStamp:0,T())},y=function(){addEventListener(\"visibilitychange\",g,!0),addEventListener(\"prerenderingchange\",g,!0)},T=function(){removeEventListener(\"visibilitychange\",g,!0),removeEventListener(\"prerenderingchange\",g,!0)},E=function(){return m<0&&(m=h(),y(),o((function(){setTimeout((function(){m=h(),y()}),0)}))),{get firstHiddenTime(){return m}}},C=function(e){document.prerendering?addEventListener(\"prerenderingchange\",(function(){return e()}),!0):e()},L=[1800,3e3],w=function(e,n){n=n||{},C((function(){var t,i=E(),r=f(\"FCP\"),a=s(\"paint\",(function(e){e.forEach((function(e){\"first-contentful-paint\"===e.name&&(a.disconnect(),e.startTime<i.firstHiddenTime&&(r.value=Math.max(e.startTime-u(),0),r.entries.push(e),t(!0)))}))}));a&&(t=d(e,r,L,n.reportAllChanges),o((function(i){r=f(\"FCP\"),t=d(e,r,L,n.reportAllChanges),l((function(){r.value=performance.now()-i.timeStamp,t(!0)}))})))}))},b=[.1,.25],S=function(e,n){n=n||{},w(v((function(){var t,i=f(\"CLS\",0),r=0,a=[],c=function(e){e.forEach((function(e){if(!e.hadRecentInput){var n=a[0],t=a[a.length-1];r&&e.startTime-t.startTime<1e3&&e.startTime-n.startTime<5e3?(r+=e.value,a.push(e)):(r=e.value,a=[e])}})),r>i.value&&(i.value=r,i.entries=a,t())},u=s(\"layout-shift\",c);u&&(t=d(e,i,b,n.reportAllChanges),p((function(){c(u.takeRecords()),t(!0)})),o((function(){r=0,i=f(\"CLS\",0),t=d(e,i,b,n.reportAllChanges),l((function(){return t()}))})),setTimeout(t,0))})))},A={passive:!0,capture:!0},I=new Date,P=function(i,r){e||(e=r,n=i,t=new Date,k(removeEventListener),F())},F=function(){if(n>=0&&n<t-I){var r={entryType:\"first-input\",name:e.type,target:e.target,cancelable:e.cancelable,startTime:e.timeStamp,processingStart:e.timeStamp+n};i.forEach((function(e){e(r)})),i=[]}},M=function(e){if(e.cancelable){var n=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;\"pointerdown\"==e.type?function(e,n){var t=function(){P(e,n),r()},i=function(){r()},r=function(){removeEventListener(\"pointerup\",t,A),removeEventListener(\"pointercancel\",i,A)};addEventListener(\"pointerup\",t,A),addEventListener(\"pointercancel\",i,A)}(n,e):P(n,e)}},k=function(e){[\"mousedown\",\"keydown\",\"touchstart\",\"pointerdown\"].forEach((function(n){return e(n,M,A)}))},D=[100,300],x=function(t,r){r=r||{},C((function(){var a,c=E(),u=f(\"FID\"),l=function(e){e.startTime<c.firstHiddenTime&&(u.value=e.processingStart-e.startTime,u.entries.push(e),a(!0))},m=function(e){e.forEach(l)},h=s(\"first-input\",m);a=d(t,u,D,r.reportAllChanges),h&&p(v((function(){m(h.takeRecords()),h.disconnect()}))),h&&o((function(){var o;u=f(\"FID\"),a=d(t,u,D,r.reportAllChanges),i=[],n=-1,e=null,k(addEventListener),o=l,i.push(o),F()}))}))},B=0,R=1/0,H=0,N=function(e){e.forEach((function(e){e.interactionId&&(R=Math.min(R,e.interactionId),H=Math.max(H,e.interactionId),B=H?(H-R)/7+1:0)}))},O=function(){return r?B:performance.interactionCount||0},q=function(){\"interactionCount\"in performance||r||(r=s(\"event\",N,{type:\"event\",buffered:!0,durationThreshold:0}))},j=[200,500],_=0,z=function(){return O()-_},G=[],J={},K=function(e){var n=G[G.length-1],t=J[e.interactionId];if(t||G.length<10||e.duration>n.latency){if(t)t.entries.push(e),t.latency=Math.max(t.latency,e.duration);else{var i={id:e.interactionId,latency:e.duration,entries:[e]};J[i.id]=i,G.push(i)}G.sort((function(e,n){return n.latency-e.latency})),G.splice(10).forEach((function(e){delete J[e.id]}))}},Q=function(e,n){n=n||{},C((function(){var t;q();var i,r=f(\"INP\"),a=function(e){e.forEach((function(e){(e.interactionId&&K(e),\"first-input\"===e.entryType)&&(!G.some((function(n){return n.entries.some((function(n){return e.duration===n.duration&&e.startTime===n.startTime}))}))&&K(e))}));var n,t=(n=Math.min(G.length-1,Math.floor(z()/50)),G[n]);t&&t.latency!==r.value&&(r.value=t.latency,r.entries=t.entries,i())},c=s(\"event\",a,{durationThreshold:null!==(t=n.durationThreshold)&&void 0!==t?t:40});i=d(e,r,j,n.reportAllChanges),c&&(\"PerformanceEventTiming\"in window&&\"interactionId\"in PerformanceEventTiming.prototype&&c.observe({type:\"first-input\",buffered:!0}),p((function(){a(c.takeRecords()),r.value<0&&z()>0&&(r.value=0,r.entries=[]),i(!0)})),o((function(){G=[],_=O(),r=f(\"INP\"),i=d(e,r,j,n.reportAllChanges)})))}))},U=[2500,4e3],V={},W=function(e,n){n=n||{},C((function(){var t,i=E(),r=f(\"LCP\"),a=function(e){var n=e[e.length-1];n&&n.startTime<i.firstHiddenTime&&(r.value=Math.max(n.startTime-u(),0),r.entries=[n],t())},c=s(\"largest-contentful-paint\",a);if(c){t=d(e,r,U,n.reportAllChanges);var m=v((function(){V[r.id]||(a(c.takeRecords()),c.disconnect(),V[r.id]=!0,t(!0))}));[\"keydown\",\"click\"].forEach((function(e){addEventListener(e,(function(){return setTimeout(m,0)}),!0)})),p(m),o((function(i){r=f(\"LCP\"),t=d(e,r,U,n.reportAllChanges),l((function(){r.value=performance.now()-i.timeStamp,V[r.id]=!0,t(!0)}))}))}}))},X=[800,1800],Y=function e(n){document.prerendering?C((function(){return e(n)})):\"complete\"!==document.readyState?addEventListener(\"load\",(function(){return e(n)}),!0):setTimeout(n,0)},Z=function(e,n){n=n||{};var t=f(\"TTFB\"),i=d(e,t,X,n.reportAllChanges);Y((function(){var r=c();if(r){var a=r.responseStart;if(a<=0||a>performance.now())return;t.value=Math.max(a-u(),0),t.entries=[r],i(!0),o((function(){t=f(\"TTFB\",0),(i=d(e,t,X,n.reportAllChanges))(!0)}))}}))};export{b as CLSThresholds,L as FCPThresholds,D as FIDThresholds,j as INPThresholds,U as LCPThresholds,X as TTFBThresholds,S as getCLS,w as getFCP,x as getFID,Q as getINP,W as getLCP,Z as getTTFB,S as onCLS,w as onFCP,x as onFID,Q as onINP,W as onLCP,Z as onTTFB};\n"],"names":["denyList","shouldCollectEvent","params","length","undefined","hostname","i","parsed","domainMatchesPattern","comparePath","pathname","setDenyList","denyListConfig","url","indexOf","substring","firstSlash","host","split","push","pattern","domain","path","HarvestScheduler","SharedContext","constructor","endpoint","opts","parent","_this$sharedContext","super","this","started","timeoutHandle","aborted","harvest","Harvest","sharedContext","subscribeToEOL","unload","bind","ee","on","SESSION_EVENTS","RESET","runHarvest","forceNoRetry","onUnload","startTimer","interval","initialDelay","scheduleHarvest","stopTimer","permanently","arguments","clearTimeout","delay","setTimeout","cbRanAfterSend","result","retry","onHarvestFinished","submitMethod","payload","harvests","getPayload","submitData","isFinalHarvest","Object","prototype","toString","call","send","args","sendX","raw","_send","forEach","cbFinished","customUrl","onFinished","sent","retryDelay","hasOwnProp","hasOwnProperty","MAX_ATTRIBUTES","nullable","val","fn","comma","numeric","n","noDefault","Math","floor","getAddStringContext","agentIdentifier","stringTable","create","stringTableIdx","str","obfuscator","Obfuscator","String","shouldObfuscate","obfuscateString","replace","escapable","quoteString","addCustomAttributes","attrs","addString","attrParts","mapOwn","key","serializedValue","type","stringify","START","END","UNLOAD_EVENT","REDIRECT","DOMAIN_LOOKUP","ONNECT","REQUEST","RESPONSE","LOAD_EVENT","DOM_CONTENT_LOAD_EVENT","navTimingValues","addPT","offset","pt","v","isL1Api","of","handleValue","domLoading","domInteractive","domComplete","addPN","pn","navigate","reload","back_forward","prerender","redirectCount","value","obj","prop","isOldApi","max","round","isWorkerScope","globalScope","cleanupTasks","origClose","close","task","cb","isBrowserScope","subscribeToVisibilityChange","windowAddEventListener","VITAL_NAMES","FIRST_PAINT","FIRST_CONTENTFUL_PAINT","FIRST_INPUT_DELAY","LARGEST_CONTENTFUL_PAINT","CUMULATIVE_LAYOUT_SHIFT","INTERACTION_TO_NEXT_PAINT","LONG_TASK","TIME_TO_FIRST_BYTE","firstContentfulPaint","VitalMetric","iOSBelow16","initiallyHidden","paintEntries","performance","getEntriesByType","entry","name","update","startTime","entries","e","onFCP","_ref","isValid","firstPaint","handleEntries","observer","disconnect","PerformanceObserver","supportedEntryTypes","includes","list","Promise","resolve","then","getEntries","observe","buffered","roundingMethod","_classPrivateFieldInitSpec","_subscribers","writable","Set","_defineProperty","state","history","_classPrivateFieldGet","current","subscribe","callback","add","delete","lastId","InteractionNode","interaction","timestamp","defineProperty","id","children","end","jsEnd","start","jsTime","cancelled","InteractionNodePrototype","child","dontWait","nodes","onNodeAdded","node","remaining","exclusiveTime","lastCb","cancel","finish","_parent","lastFinish","checkFinish","originalSetTimeout","originals","ST","originalClearTimeout","CT","Interaction","eventName","routeName","get","finishTimer","checkingFinish","handlers","done","root","trigger","initialPageURL","getRuntime","origin","oldRoute","newURL","oldURL","custom","store","InteractionPrototype","_resetFinishCheck","setNewURL","setNewRoute","route","newRoute","endTimestamp","customAttrs","getInfo","jsAttributes","attr","emit","Serializer","firstTimestamp","serializeMultiple","interactions","navTiming","info","serialized","serializeInteraction","routeChange","serializeSingle","isRouteChange","isInitialPage","typeIdsByName","ajax","customTracer","includeHashFragment","addNode","nodeList","typeName","typeId","startTimestamp","childCount","attrCount","apmAttributes","atts","hasNavTiming","metrics","queueTime","appTime","applicationTime","fields","cleanURL","customName","concat","method","status","txSize","rxSize","isFetch","isJSONP","dt","spanId","traceId","keys","gql","ajaxAttrParts","tracedTime","unshift","join","seperator","navTimingNode","prev","slice","FEATURE_NAME","INTERACTION_EVENTS","MAX_TIMER_BUDGET","FN_START","FN_END","CB_START","INTERACTION_API","REMAINING","INTERACTION","SPA_NODE","JSONP_NODE","FETCH_START","FETCH_DONE","FETCH_BODY","JSONP_END","CONSTANTS","Aggregate","AggregateBase","aggregator","lastSeenUrl","lastSeenRouteName","timerMap","timerBudget","currentNode","prevNode","nodeOnLastHashUpdate","initialPageLoad","pageLoaded","childTime","depth","harvestTimeSeconds","getConfigurationValue","interactionsToHarvest","interactionsSent","disableSpaFix","serializer","blocked","baseEE","mutationEE","promiseEE","historyEE","eventsEE","timerEE","fetchEE","jsonpEE","xhrEE","tracerEE","scheduler","options","body","register","featureName","onInteractionFinished","save","prevInteraction","callbackStart","pluginApi","getCurrentNode","setCurrentNode","init","FEATURE_NAMES","spa","callbackEnd","eventSource","ev","evName","eventNode","bundleId","window","loadedAsDeferredBrowserScript","XMLHttpRequest","context","spaNode","ixn","nodeType","tagName","toLowerCase","title","innerText","getActionText","target","actionText","timerId","timerDuration","Function","ignored","endTime","parseUrl","port","fetchArguments","dtPayload","ctx","bodyPromise","err","res","hashChangedDuringCb","el","isScript","nodeName","src","addEventListener","eventListenerOpts","resolvePromise","overwrite","getCtx","t","_state$currentNode","_state$prevNode","_state$prevNode2","activeNodeFor","inc","tracerDone","currentRouteName","_interactionId","_interactionNodeId","_interaction$root","_interaction$root2","_interaction$root3","_interaction$root4","generateUuid","smCategory","handle","SUPPORTABILITY_METRIC_CHANNEL","drain","ct","totalTime","isTraced","interactionContext","hasCb","resolved","newNode","r","a","o","persisted","timeStamp","c","u","activationStart","f","document","prerendering","wasDiscarded","rating","delta","Date","now","random","navigationType","s","assign","d","l","requestAnimationFrame","p","visibilityState","m","h","g","T","y","removeEventListener","E","firstHiddenTime","C","L","w","reportAllChanges","b","S","hadRecentInput","takeRecords","A","passive","capture","I","P","k","F","entryType","cancelable","processingStart","M","D","x","B","R","H","N","interactionId","min","O","interactionCount","q","durationThreshold","j","_","z","G","J","K","duration","latency","sort","splice","Q","some","PerformanceEventTiming","U","V","W","X","Y","readyState","Z","responseStart"],"sourceRoot":""}