"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[78],{7661:(t,e,s)=>{s.d(e,{o:()=>h});var i=s(3197),n=s(3114),r=s(2041),o=s(8464),a=s(2162);class h extends n.w{constructor(t,e,s){var i;super(s),this.endpoint=t,this.opts=e||{},this.started=!1,this.timeoutHandle=null,this.aborted=!1,this.harvest=new r.M(this.sharedContext),(0,o.L)(this.unload.bind(this)),null===(i=this.sharedContext)||void 0===i||i.ee.on(a.wO.RESET,(()=>this.runHarvest({forceNoRetry:!0})))}unload(){this.aborted||(this.opts.onUnload&&this.opts.onUnload(),this.runHarvest({unload:!0}))}startTimer(t,e){this.interval=t,this.started=!0,this.scheduleHarvest(null!=e?e:this.interval)}stopTimer(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.aborted=t,this.started=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)}scheduleHarvest(t,e){this.timeoutHandle||(null==t&&(t=this.interval),this.timeoutHandle=setTimeout((()=>{this.timeoutHandle=null,this.runHarvest(e)}),1e3*t))}runHarvest(t){if(this.aborted)return;const e=e=>{null!==t&&void 0!==t&&t.forceNoRetry&&(e.retry=!1),this.onHarvestFinished(t,e)};let s,n,r=[];if(this.opts.getPayload){if(s=i.qD({isFinalHarvest:null===t||void 0===t?void 0:t.unload}),!s)return!1;const e=!(null!==t&&void 0!==t&&t.unload)&&s===i.Be;if(n=this.opts.getPayload({retry:e}),!n)return void(this.started&&this.scheduleHarvest());n="[object Array]"===Object.prototype.toString.call(n)?n:[n],r.push(...n)}let o=t=>this.harvest.sendX(t);r.length?o=this.opts.raw?t=>this.harvest._send(t):t=>this.harvest.send(t):r.push(void 0),r.forEach((i=>{o({endpoint:this.endpoint,payload:i,opts:t,submitMethod:s,cbFinished:e,customUrl:this.opts.customUrl,raw:this.opts.raw})})),this.started&&this.scheduleHarvest()}onHarvestFinished(t,e){if(this.opts.onFinished&&this.opts.onFinished(e),e.sent&&e.retry){const s=e.delay||this.opts.retryDelay;this.started&&s?(clearTimeout(this.timeoutHandle),this.timeoutHandle=null,this.scheduleHarvest(s,t)):!this.started&&s&&this.scheduleHarvest(s,t)}}}},8464:(t,e,s)=>{s.d(e,{L:()=>o});var i=s(1997),n=s(3980),r=s(536);if(n.v6){n._A.cleanupTasks=[];const t=n._A.close;n._A.close=()=>{for(let t of n._A.cleanupTasks)t();t()}}function o(t){n.il?((0,r.N)(t,!0),(0,i.bP)("pagehide",t)):n.v6&&n._A.cleanupTasks.push(t)}},2337:(t,e,s)=>{s.r(e),s.d(e,{Aggregate:()=>v});var i=s(4572),n=s(3973),r=s(8038),o=s(4613),a=s(7661),h=s(8575),d=s(8958),l=s(8214),u=s(3980),c=s(1527);class v extends c.m{constructor(t,e){var s;super(t,e,l.t),s=this,this.eventsPerMinute=240,this.harvestTimeSeconds=(0,d.Mt)(this.agentIdentifier,"page_action.harvestTimeSeconds")||(0,d.Mt)(this.agentIdentifier,"ins.harvestTimeSeconds")||30,this.eventsPerHarvest=this.eventsPerMinute*this.harvestTimeSeconds/60,this.referrerUrl=void 0,this.currentEvents=void 0,this.events=[],this.att=(0,d.C5)(this.agentIdentifier).jsAttributes,u.il&&document.referrer&&(this.referrerUrl=(0,h.f)(document.referrer)),(0,o.X)("api-addPageAction",(function(){return s.addPageAction(...arguments)}),this.featureName,this.ee),this.waitForFlags(["ins"]).then((t=>{let[e]=t;if(e){const t=new a.o("ins",{onFinished:function(){return s.onHarvestFinished(...arguments)}},this);t.harvest.on("ins",(function(){return s.onHarvestStarted(...arguments)})),t.startTimer(this.harvestTimeSeconds,0)}else this.blocked=!0})),this.drain()}onHarvestStarted(t){const{userAttributes:e,atts:s}=(0,d.C5)(this.agentIdentifier);var i={qs:{ua:e,at:s},body:{ins:this.events}};return t.retry&&(this.currentEvents=this.events),this.events=[],i}onHarvestFinished(t){t&&t.sent&&t.retry&&this.currentEvents&&(this.events=this.events.concat(this.currentEvents),this.currentEvents=null)}addPageAction(t,e,s){if(!(this.events.length>=this.eventsPerHarvest||this.blocked)){var i,o,a={};u.il&&window.document.documentElement&&(i=window.document.documentElement.clientWidth,o=window.document.documentElement.clientHeight);var l={timestamp:t+(0,d.OP)(this.agentIdentifier).offset,timeSinceLoad:t/1e3,browserWidth:i,browserHeight:o,referrerUrl:this.referrerUrl,currentUrl:(0,h.f)(""+location),pageUrl:(0,h.f)((0,d.OP)(this.agentIdentifier).origin),eventType:"PageAction"};(0,n.D)(l,c),(0,n.D)((0,d.C5)(this.agentIdentifier).jsAttributes,c),s&&"object"===typeof s&&(0,n.D)(s,c),a.actionName=e||"",this.events.push(a)}function c(t,e){a[t]=e&&"object"===typeof e?(0,r.P)(e):e}}}(0,i.Z)(v,"featureName",l.t)}}]);
//# sourceMappingURL=page_action-aggregate.d27baa96.chunk.js.map